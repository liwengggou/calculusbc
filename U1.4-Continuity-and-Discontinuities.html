<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U1.4 Continuity and Discontinuities | AP Calculus BC</title>

    <!-- KaTeX for mathematical notation -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Plotly.js for graphs -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Math.js for calculations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.2.1/math.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Annotation System -->
    <link rel="stylesheet" href="lib/annotation.css">

    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #495057;
            --text-muted: #6c757d;
            --accent-primary: #4361ee;
            --accent-secondary: #3f37c9;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --border-color: #dee2e6;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --text-primary: #eef0f2;
            --text-secondary: #c9ccd1;
            --text-muted: #8b8f94;
            --border-color: #2d3748;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        .header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 40px 20px;
            margin-bottom: 30px;
            border-radius: var(--radius-lg);
        }

        .header-content { max-width: 1200px; margin: 0 auto; }

        .unit-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }

        .header-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .freq-badge {
            background: rgba(255,255,255,0.25);
            padding: 2px 10px;
            border-radius: 12px;
            font-weight: 600;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            z-index: 1000;
            transition: all 0.3s;
        }

        .theme-toggle:hover { transform: scale(1.1); }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            background: var(--bg-secondary);
            padding: 10px;
            border-radius: var(--radius-lg);
            margin-bottom: 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-tab:hover { background: var(--bg-tertiary); }
        .nav-tab.active { background: var(--accent-primary); color: white; }

        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 30px;
            background: var(--accent-primary);
            border-radius: 2px;
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .key-point {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin-bottom: 10px;
            border-left: 4px solid var(--accent-primary);
        }

        .key-point-number {
            background: var(--accent-primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .prereq-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            margin-bottom: 15px;
            overflow: hidden;
        }

        .prereq-header {
            padding: 15px 20px;
            background: var(--bg-tertiary);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .prereq-header:hover { background: var(--border-color); }

        .prereq-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prereq-badge {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--accent-warning);
            color: white;
        }

        .prereq-badge.internal { background: var(--accent-primary); }

        .prereq-content { padding: 20px; display: none; }
        .prereq-content.active { display: block; }

        .prereq-toggle { font-size: 1.2rem; transition: transform 0.3s; }
        .prereq-card.open .prereq-toggle { transform: rotate(180deg); }

        .problem-type {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            margin-bottom: 15px;
            overflow: hidden;
        }

        .problem-type-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            user-select: none;
            flex-wrap: wrap;
            gap: 10px;
        }

        .problem-type-header:hover { background: var(--bg-tertiary); }

        .problem-type-title { font-weight: 600; font-size: 1.1rem; }

        .toggle-icon {
            font-size: 0.9rem;
            transition: transform 0.3s ease;
            margin-left: auto;
            padding-left: 15px;
        }

        .problem-type.collapsed .toggle-icon { transform: rotate(-90deg); }

        .problem-type-content {
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            max-height: 5000px;
            opacity: 1;
            padding: 0 20px 20px;
        }

        .problem-type.collapsed .problem-type-content {
            max-height: 0;
            opacity: 0;
            padding: 0 20px;
        }

        .difficulty-badge {
            font-size: 0.75rem;
            padding: 2px 10px;
            border-radius: 10px;
            font-weight: 500;
        }

        .difficulty-badge.easy { background: #d1fae5; color: #065f46; }
        .difficulty-badge.medium { background: #fef3c7; color: #92400e; }
        .difficulty-badge.hard { background: #fee2e2; color: #991b1b; }

        [data-theme="dark"] .difficulty-badge.easy { background: #065f46; color: #d1fae5; }
        [data-theme="dark"] .difficulty-badge.medium { background: #92400e; color: #fef3c7; }
        [data-theme="dark"] .difficulty-badge.hard { background: #991b1b; color: #fee2e2; }

        .pattern-box {
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
            border: 2px dashed var(--accent-primary);
            border-radius: var(--radius-md);
            padding: 20px;
            margin: 15px 0;
        }

        .pattern-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            color: var(--accent-primary);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .theorem-box {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(63, 55, 201, 0.1));
            border: 2px solid var(--accent-primary);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin: 20px 0;
        }

        .theorem-title {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--accent-primary);
            margin-bottom: 15px;
        }

        .exam-tip {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid var(--accent-warning);
            padding: 15px 20px;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            margin: 15px 0;
        }

        [data-theme="dark"] .exam-tip {
            background: linear-gradient(135deg, #78350f, #92400e);
        }

        .exam-tip-label {
            font-weight: 600;
            color: var(--accent-warning);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 5px;
        }

        .worked-example {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin: 20px 0;
        }

        .example-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--accent-primary);
        }

        .example-problem {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: var(--radius-md);
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }

        .animation-container {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin: 15px 0;
        }

        .animation-step {
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: 10px;
            border-left: 4px solid var(--accent-primary);
            display: none;
        }

        .animation-step.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .step-number {
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 5px;
        }

        .step-reasoning {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed var(--border-color);
        }

        .animation-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            min-width: 100px;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-primary);
            transition: width 0.3s ease;
        }

        .step-counter {
            font-size: 0.85rem;
            color: var(--text-muted);
            min-width: 80px;
            text-align: center;
        }

        .practice-problem {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin: 15px 0;
        }

        .practice-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            color: var(--accent-success);
            font-weight: 600;
            margin-bottom: 10px;
        }

        .practice-question { font-size: 1.1rem; margin-bottom: 15px; }

        .practice-options { display: grid; gap: 10px; }

        .practice-option {
            padding: 12px 15px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .practice-option:hover { border-color: var(--accent-primary); }
        .practice-option.selected { border-color: var(--accent-primary); background: rgba(67, 97, 238, 0.1); }
        .practice-option.correct { border-color: var(--accent-success); background: rgba(16, 185, 129, 0.1); }
        .practice-option.incorrect { border-color: var(--accent-danger); background: rgba(239, 68, 68, 0.1); }

        .practice-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: var(--radius-md);
            display: none;
        }

        .practice-feedback.show { display: block; }
        .practice-feedback.correct { background: rgba(16, 185, 129, 0.1); border: 1px solid var(--accent-success); }
        .practice-feedback.incorrect { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--accent-danger); }

        .decision-flowchart {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .flowchart-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: var(--accent-primary);
            text-align: center;
        }

        .flowchart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .flowchart-node {
            padding: 12px 20px;
            border-radius: var(--radius-md);
            text-align: center;
            max-width: 300px;
        }

        .flowchart-node.question { background: var(--accent-primary); color: white; font-weight: 500; }
        .flowchart-node.answer { background: var(--bg-tertiary); border: 2px solid var(--border-color); }
        .flowchart-node.success { background: rgba(16, 185, 129, 0.1); border: 2px solid var(--accent-success); color: var(--accent-success); }
        .flowchart-node.warning { background: rgba(245, 158, 11, 0.1); border: 2px solid var(--accent-warning); color: var(--accent-warning); }
        .flowchart-node.danger { background: rgba(239, 68, 68, 0.1); border: 2px solid var(--accent-danger); color: var(--accent-danger); }

        .flowchart-arrow { font-size: 1.5rem; color: var(--text-muted); }

        .flowchart-branch { display: flex; gap: 40px; justify-content: center; flex-wrap: wrap; }

        .flowchart-branch-item { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .flowchart-branch-label { padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600; }
        .flowchart-branch-label.yes { background: var(--accent-success); color: white; }
        .flowchart-branch-label.no { background: var(--accent-danger); color: white; }

        .mistake-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 15px;
        }

        .mistake-wrong {
            background: rgba(239, 68, 68, 0.1);
            padding: 12px 15px;
            border-radius: var(--radius-md);
            margin-bottom: 10px;
            text-decoration: line-through;
            color: var(--accent-danger);
        }

        .mistake-correct {
            background: rgba(16, 185, 129, 0.1);
            padding: 12px 15px;
            border-radius: var(--radius-md);
            margin-bottom: 10px;
            border-left: 4px solid var(--accent-success);
        }

        .mistake-reason { font-size: 0.9rem; color: var(--text-muted); padding-top: 10px; }

        .connection-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .connection-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .connection-content h4 { font-size: 1rem; margin-bottom: 5px; }
        .connection-content p { font-size: 0.9rem; color: var(--text-muted); }

        .graph-container {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 15px;
            margin: 15px 0;
        }

        .checklist { background: var(--bg-secondary); border-radius: var(--radius-lg); padding: 20px; }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .checklist-item:last-child { border-bottom: none; }
        .checklist-checkbox { width: 20px; height: 20px; cursor: pointer; }

        /* Discontinuity Types Visual */
        .discontinuity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .discontinuity-card {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
        }

        .discontinuity-card h4 {
            margin-bottom: 10px;
            color: var(--accent-primary);
        }

        .discontinuity-card .graph-mini {
            height: 150px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .nav-tabs { justify-content: center; }
            .nav-tab { padding: 8px 12px; font-size: 0.85rem; }
            .flowchart-branch { flex-direction: column; gap: 20px; }
        }

        /* ========== TRANSLATION POPUP ========== */
        .translate-popup {
            position: absolute;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            padding: 8px;
            z-index: 10000;
            animation: translateFadeIn 0.2s ease;
            max-width: 350px;
        }

        @keyframes translateFadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-5px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        .translate-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .translate-btn:hover { background: #2563eb; transform: scale(1.02); }
        .translate-btn:disabled { background: var(--text-muted); cursor: not-allowed; transform: none; }

        .translation-result {
            margin-top: 8px;
            padding: 10px 12px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-primary);
            word-wrap: break-word;
        }

        .translation-error {
            color: var(--accent-danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .translate-popup::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--bg-primary);
        }

        .translate-popup.below::after {
            top: -8px;
            bottom: auto;
            border-top-color: transparent;
            border-bottom-color: var(--bg-primary);
        }

        /* ========== INLINE PRACTICE ========== */
        .inline-practice {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 20px;
        }

        .inline-practice-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-success);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .inline-practice-title::before {
            content: '‚úèÔ∏è';
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">üåô</button>

    <header class="header">
        <div class="header-content">
            <span class="unit-badge">Unit 1: Limits and Continuity</span>
            <h1>U1.4 Continuity and Discontinuities</h1>
            <p>Master the three conditions for continuity and identify types of discontinuities</p>
            <div class="header-meta">
                <span class="meta-item">üìö CB Topics: 1.9, 1.10, 1.11, 1.12, 1.13</span>
                <span class="meta-item"><span class="freq-badge">üìö Standard</span></span>
                <span class="meta-item">‚è±Ô∏è ~50 min</span>
                <span class="meta-item">üìä MCQ: 26 questions</span>
            </div>
        </div>
    </header>

    <div class="container">
        <nav class="nav-tabs">
            <button class="nav-tab active" data-section="keypoints">Key Points</button>
            <button class="nav-tab" data-section="prerequisites">Prerequisites</button>
            <button class="nav-tab" data-section="concepts">Concepts</button>
            <button class="nav-tab" data-section="problemtypes">Problem Types</button>
            <button class="nav-tab" data-section="examtips">Exam Tips</button>
            <button class="nav-tab" data-section="mistakes">Common Mistakes</button>
            <button class="nav-tab" data-section="connections">Connections</button>
        </nav>

        <!-- Key Points Section -->
        <section id="keypoints" class="section active">
            <h2 class="section-title">Key Points</h2>

            <div class="key-point">
                <span class="key-point-number">1</span>
                <div>
                    <strong>Three conditions for continuity at \(x = a\):</strong><br>
                    (1) \(f(a)\) exists, (2) \(\lim_{x \to a} f(x)\) exists, (3) \(\lim_{x \to a} f(x) = f(a)\)
                </div>
            </div>

            <div class="key-point">
                <span class="key-point-number">2</span>
                <div>
                    <strong>Three types of discontinuities:</strong><br>
                    ‚Ä¢ <em>Removable</em> (hole): limit exists but doesn't equal \(f(a)\)<br>
                    ‚Ä¢ <em>Jump</em>: left and right limits exist but differ<br>
                    ‚Ä¢ <em>Infinite</em> (vertical asymptote): limit is \(\pm\infty\)
                </div>
            </div>

            <div class="key-point">
                <span class="key-point-number">3</span>
                <div>
                    <strong>A removable discontinuity can be "removed"</strong> by defining or redefining \(f(a)\) to equal the limit value.
                </div>
            </div>

            <div class="key-point">
                <span class="key-point-number">4</span>
                <div>
                    <strong>Continuity on an interval:</strong> A function is continuous on \([a, b]\) if it's continuous at every point in \((a, b)\), continuous from the right at \(a\), and continuous from the left at \(b\).
                </div>
            </div>

            <div class="key-point">
                <span class="key-point-number">5</span>
                <div>
                    <strong>Standard continuous functions:</strong> Polynomials, rational functions (where defined), \(\sin x\), \(\cos x\), \(e^x\), \(\ln x\) (for \(x > 0\)) are all continuous on their domains.
                </div>
            </div>
        </section>

        <!-- Prerequisites Section -->
        <section id="prerequisites" class="section">
            <h2 class="section-title">Prerequisites</h2>

            <div class="prereq-card">
                <div class="prereq-header" onclick="togglePrereq(this)">
                    <span class="prereq-title">
                        <span class="prereq-badge">PreCalc</span>
                        Piecewise Functions
                    </span>
                    <span class="prereq-toggle">‚ñº</span>
                </div>
                <div class="prereq-content">
                    <p><strong>Why it matters:</strong> Many continuity problems involve piecewise functions where you must check continuity at the boundary points.</p>

                    <div class="pattern-box">
                        <div class="pattern-label">Piecewise Function Form</div>
                        <p>\(f(x) = \begin{cases} g(x) & \text{if } x < a \\ h(x) & \text{if } x \geq a \end{cases}\)</p>
                        <p style="margin-top: 10px;">At \(x = a\), check: Does \(\lim_{x \to a^-} g(x) = \lim_{x \to a^+} h(x) = f(a)\)?</p>
                    </div>

                    <div class="practice-problem">
                        <div class="practice-label">Quick Check</div>
                        <div class="practice-question">For \(f(x) = \begin{cases} x^2 & x < 2 \\ 4 & x = 2 \\ 2x & x > 2 \end{cases}\), what is \(f(2)\)?</div>
                        <div class="practice-options">
                            <div class="practice-option" data-correct="true">4</div>
                            <div class="practice-option">\(2^2 = 4\)</div>
                            <div class="practice-option">\(2(2) = 4\)</div>
                            <div class="practice-option">Undefined</div>
                        </div>
                        <div class="practice-feedback"></div>
                    </div>
                </div>
            </div>

            <div class="prereq-card">
                <div class="prereq-header" onclick="togglePrereq(this)">
                    <span class="prereq-title">
                        <span class="prereq-badge internal">Internal</span>
                        U1.1 Existence of Limits
                    </span>
                    <span class="prereq-toggle">‚ñº</span>
                </div>
                <div class="prereq-content">
                    <p>Before studying continuity, you must understand:</p>
                    <ul style="margin: 10px 0 10px 20px;">
                        <li>When limits exist (left = right)</li>
                        <li>When limits don't exist</li>
                        <li>One-sided limits</li>
                    </ul>
                    <p><a href="U1.1-Existence-of-Limit.html" style="color: var(--accent-primary);">‚Üí Review U1.1 Existence of Limits</a></p>
                </div>
            </div>

            <div class="prereq-card">
                <div class="prereq-header" onclick="togglePrereq(this)">
                    <span class="prereq-title">
                        <span class="prereq-badge internal">Internal</span>
                        U1.2 Calculating Limits
                    </span>
                    <span class="prereq-toggle">‚ñº</span>
                </div>
                <div class="prereq-content">
                    <p>To check continuity, you need to calculate limits:</p>
                    <ul style="margin: 10px 0 10px 20px;">
                        <li>Direct substitution</li>
                        <li>Factoring and canceling</li>
                        <li>Rationalization</li>
                    </ul>
                    <p><a href="U1.2-Calculating-Limit.html" style="color: var(--accent-primary);">‚Üí Review U1.2 Calculating Limits</a></p>
                </div>
            </div>
        </section>

        <!-- Concepts Section -->
        <section id="concepts" class="section">
            <h2 class="section-title">Core Concepts</h2>

            <div class="theorem-box">
                <div class="theorem-title">üìê Definition of Continuity at a Point</div>
                <p>A function \(f\) is <strong>continuous at \(x = a\)</strong> if and only if ALL THREE conditions are met:</p>
                <ol style="margin: 15px 0 0 20px;">
                    <li>\(f(a)\) is defined (the function has a value at \(a\))</li>
                    <li>\(\displaystyle\lim_{x \to a} f(x)\) exists (left and right limits are equal)</li>
                    <li>\(\displaystyle\lim_{x \to a} f(x) = f(a)\) (the limit equals the function value)</li>
                </ol>
            </div>

            <div class="decision-flowchart">
                <div class="flowchart-title">Decision Flowchart: Is f continuous at x = a?</div>
                <div class="flowchart-container">
                    <div class="flowchart-node question">Step 1: Is f(a) defined?</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-branch">
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label yes">YES</div>
                            <div class="flowchart-node answer">Continue to Step 2</div>
                        </div>
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label no">NO</div>
                            <div class="flowchart-node danger">NOT continuous</div>
                        </div>
                    </div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node question">Step 2: Does lim f(x) as x‚Üía exist?</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-branch">
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label yes">YES</div>
                            <div class="flowchart-node answer">Continue to Step 3</div>
                        </div>
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label no">NO</div>
                            <div class="flowchart-node danger">NOT continuous (jump or infinite)</div>
                        </div>
                    </div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node question">Step 3: Does lim f(x) = f(a)?</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-branch">
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label yes">YES</div>
                            <div class="flowchart-node success">CONTINUOUS at a ‚úì</div>
                        </div>
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label no">NO</div>
                            <div class="flowchart-node warning">NOT continuous (removable)</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Three Types of Discontinuities</h3>
                <div class="discontinuity-grid">
                    <div class="discontinuity-card">
                        <h4>Removable (Hole)</h4>
                        <div class="graph-mini" id="graph-removable"></div>
                        <p>Limit exists but ‚â† f(a)<br><small>Can be "fixed" by redefining f(a)</small></p>
                    </div>
                    <div class="discontinuity-card">
                        <h4>Jump</h4>
                        <div class="graph-mini" id="graph-jump"></div>
                        <p>Left and right limits differ<br><small>Cannot be fixed</small></p>
                    </div>
                    <div class="discontinuity-card">
                        <h4>Infinite (Asymptote)</h4>
                        <div class="graph-mini" id="graph-infinite"></div>
                        <p>Limit is ¬±‚àû<br><small>Cannot be fixed</small></p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Removing Discontinuities</h3>
                <p>A <strong>removable discontinuity</strong> occurs when:</p>
                <ul style="margin: 10px 0 10px 20px;">
                    <li>The limit \(\lim_{x \to a} f(x) = L\) exists</li>
                    <li>But either \(f(a)\) is undefined OR \(f(a) \neq L\)</li>
                </ul>
                <p style="margin-top: 15px;">To remove it: <strong>Define or redefine \(f(a) = L\)</strong></p>

                <div class="pattern-box">
                    <div class="pattern-label">Example</div>
                    <p>\(f(x) = \frac{x^2 - 4}{x - 2}\) has a removable discontinuity at \(x = 2\).</p>
                    <p style="margin-top: 10px;">Since \(\lim_{x \to 2} f(x) = 4\), we can remove it by defining \(f(2) = 4\).</p>
                </div>
            </div>
        </section>

        <!-- Problem Types Section -->
        <section id="problemtypes" class="section">
            <h2 class="section-title">Problem Types</h2>

            <!-- Type 1: Three-Condition Check -->
            <div class="problem-type collapsed" id="problem-type-1">
                <div class="problem-type-header">
                    <span class="problem-type-title">Type 1: Three-Condition Continuity Check</span>
                    <span class="difficulty-badge easy">Basic</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="problem-type-content">
                    <div class="pattern-box">
                        <div class="pattern-label">Recognition Pattern</div>
                        <p>"Is f continuous at x = a?" or "At which points is f discontinuous?"</p>
                    </div>

                    <div class="exam-tip">
                        <div class="exam-tip-label">üí° EXAM TIP</div>
                        Always check all THREE conditions systematically. Don't skip any!
                    </div>

                    <div class="worked-example">
                        <div class="example-title">Worked Example</div>
                        <div class="example-problem">
                            Is \(f(x) = \frac{x^2 - 1}{x - 1}\) continuous at \(x = 1\)?
                        </div>

                        <div class="animation-container" id="anim-three-condition">
                            <div class="animation-step" data-step="1">
                                <div class="step-number">Step 1: Check if f(1) is defined</div>
                                <p>\(f(1) = \frac{1^2 - 1}{1 - 1} = \frac{0}{0}\) ‚Äî undefined!</p>
                                <div class="step-reasoning">üí≠ We can't divide by zero, so f(1) doesn't exist.</div>
                            </div>
                            <div class="animation-step" data-step="2">
                                <div class="step-number">Step 2: Conclusion</div>
                                <p>Since \(f(1)\) is not defined, \(f\) is <strong>NOT continuous</strong> at \(x = 1\).</p>
                                <div class="step-reasoning">üí≠ Condition 1 failed ‚Äî no need to check the other conditions!</div>
                            </div>
                            <div class="animation-step" data-step="3">
                                <div class="step-number">Bonus: What type of discontinuity?</div>
                                <p>\(\lim_{x \to 1} \frac{x^2 - 1}{x - 1} = \lim_{x \to 1} \frac{(x-1)(x+1)}{x-1} = \lim_{x \to 1} (x+1) = 2\)</p>
                                <p style="margin-top: 10px;">The limit exists, so this is a <strong>removable discontinuity</strong> (a "hole").</p>
                                <div class="step-reasoning">üí≠ We could remove it by defining f(1) = 2.</div>
                            </div>
                            <div class="animation-controls">
                                <button class="control-btn" onclick="animPrev('anim-three-condition')">‚Üê Prev</button>
                                <button class="control-btn" onclick="animNext('anim-three-condition')">Next ‚Üí</button>
                                <div class="progress-bar"><div class="progress-fill" style="width: 33%"></div></div>
                                <span class="step-counter">Step 1 of 3</span>
                                <button class="control-btn" onclick="animReset('anim-three-condition')">Reset</button>
                            </div>
                        </div>
                    </div>

                    <div class="inline-practice">
                        <h4 class="inline-practice-title">Practice This Type</h4>
                        <div class="practice-problem">
                            <div class="practice-label">Practice Problem</div>
                            <div class="practice-question">Is \(f(x) = \frac{x^2 - 4}{x + 2}\) continuous at \(x = -2\)?</div>
                            <div class="practice-options">
                                <div class="practice-option">Yes, it's continuous</div>
                                <div class="practice-option" data-correct="true">No, f(-2) is undefined</div>
                                <div class="practice-option">No, the limit doesn't exist</div>
                                <div class="practice-option">Cannot be determined</div>
                            </div>
                            <div class="practice-feedback"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Type 2: Identify Discontinuity Type -->
            <div class="problem-type collapsed" id="problem-type-2">
                <div class="problem-type-header">
                    <span class="problem-type-title">Type 2: Identify Discontinuity Type</span>
                    <span class="difficulty-badge medium">Intermediate</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="problem-type-content">
                    <div class="pattern-box">
                        <div class="pattern-label">Recognition Pattern</div>
                        <p>"What type of discontinuity does f have at x = a?"</p>
                    </div>

                    <div class="decision-flowchart">
                        <div class="flowchart-title">Classifying Discontinuity Type</div>
                        <div class="flowchart-container">
                            <div class="flowchart-node question">Does lim f(x) as x‚Üía exist?</div>
                            <div class="flowchart-arrow">‚Üì</div>
                            <div class="flowchart-branch">
                                <div class="flowchart-branch-item">
                                    <div class="flowchart-branch-label yes">YES</div>
                                    <div class="flowchart-node success">REMOVABLE (hole)</div>
                                </div>
                                <div class="flowchart-branch-item">
                                    <div class="flowchart-branch-label no">NO</div>
                                    <div class="flowchart-node answer">Why not?</div>
                                </div>
                            </div>
                            <div class="flowchart-arrow">‚Üì</div>
                            <div class="flowchart-branch">
                                <div class="flowchart-branch-item">
                                    <div class="flowchart-branch-label yes">Left ‚â† Right</div>
                                    <div class="flowchart-node warning">JUMP</div>
                                </div>
                                <div class="flowchart-branch-item">
                                    <div class="flowchart-branch-label no">‚Üí ¬±‚àû</div>
                                    <div class="flowchart-node danger">INFINITE</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="practice-problem">
                        <div class="practice-label">Practice Problem</div>
                        <div class="practice-question">What type of discontinuity does \(f(x) = \frac{1}{x-3}\) have at \(x = 3\)?</div>
                        <div class="practice-options">
                            <div class="practice-option">Removable</div>
                            <div class="practice-option">Jump</div>
                            <div class="practice-option" data-correct="true">Infinite</div>
                            <div class="practice-option">No discontinuity</div>
                        </div>
                        <div class="practice-feedback"></div>
                    </div>
                </div>
            </div>

            <!-- Type 3: Find k for Continuity -->
            <div class="problem-type collapsed" id="problem-type-3">
                <div class="problem-type-header">
                    <span class="problem-type-title">Type 3: Find k to Make Function Continuous</span>
                    <span class="difficulty-badge medium">Intermediate</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="problem-type-content">
                    <div class="pattern-box">
                        <div class="pattern-label">Recognition Pattern</div>
                        <p>Piecewise function with parameter k: "Find k such that f is continuous"</p>
                    </div>

                    <div class="exam-tip">
                        <div class="exam-tip-label">üí° EXAM TIP</div>
                        Set left limit = right limit = function value at the boundary. This usually gives an equation to solve for k.
                    </div>

                    <div class="worked-example">
                        <div class="example-title">Worked Example</div>
                        <div class="example-problem">
                            Find \(k\) so that \(f(x) = \begin{cases} kx + 1 & x \leq 2 \\ x^2 - 1 & x > 2 \end{cases}\) is continuous at \(x = 2\).
                        </div>

                        <div class="animation-container" id="anim-find-k">
                            <div class="animation-step" data-step="1">
                                <div class="step-number">Step 1: Find f(2) from the definition</div>
                                <p>Since \(x = 2\) uses the first piece: \(f(2) = k(2) + 1 = 2k + 1\)</p>
                                <div class="step-reasoning">üí≠ Check which piece applies at the boundary. Here, x ‚â§ 2 means we use the first piece.</div>
                            </div>
                            <div class="animation-step" data-step="2">
                                <div class="step-number">Step 2: Find the left-hand limit</div>
                                <p>\(\lim_{x \to 2^-} (kx + 1) = 2k + 1\)</p>
                                <div class="step-reasoning">üí≠ From the left, we use the first piece.</div>
                            </div>
                            <div class="animation-step" data-step="3">
                                <div class="step-number">Step 3: Find the right-hand limit</div>
                                <p>\(\lim_{x \to 2^+} (x^2 - 1) = 4 - 1 = 3\)</p>
                                <div class="step-reasoning">üí≠ From the right, we use the second piece.</div>
                            </div>
                            <div class="animation-step" data-step="4">
                                <div class="step-number">Step 4: Set limits equal for continuity</div>
                                <p>For continuity: \(2k + 1 = 3\)</p>
                                <p>Solving: \(2k = 2\), so \(k = 1\)</p>
                                <div class="step-reasoning">üí≠ All three values (left limit, right limit, f(2)) must be equal.</div>
                            </div>
                            <div class="animation-controls">
                                <button class="control-btn" onclick="animPrev('anim-find-k')">‚Üê Prev</button>
                                <button class="control-btn" onclick="animNext('anim-find-k')">Next ‚Üí</button>
                                <div class="progress-bar"><div class="progress-fill" style="width: 25%"></div></div>
                                <span class="step-counter">Step 1 of 4</span>
                                <button class="control-btn" onclick="animReset('anim-find-k')">Reset</button>
                            </div>
                        </div>
                    </div>

                    <div class="practice-problem">
                        <div class="practice-label">Practice Problem</div>
                        <div class="practice-question">Find \(k\) so that \(f(x) = \begin{cases} x^2 + k & x < 1 \\ 3x & x \geq 1 \end{cases}\) is continuous at \(x = 1\).</div>
                        <div class="practice-options">
                            <div class="practice-option">k = 1</div>
                            <div class="practice-option" data-correct="true">k = 2</div>
                            <div class="practice-option">k = 3</div>
                            <div class="practice-option">k = 0</div>
                        </div>
                        <div class="practice-feedback"></div>
                    </div>
                </div>
            </div>

            <!-- Type 4: Continuity on Interval -->
            <div class="problem-type collapsed" id="problem-type-4">
                <div class="problem-type-header">
                    <span class="problem-type-title">Type 4: Continuity Over an Interval</span>
                    <span class="difficulty-badge medium">Intermediate</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="problem-type-content">
                    <div class="pattern-box">
                        <div class="pattern-label">Recognition Pattern</div>
                        <p>"On what interval is f continuous?" or "Is f continuous on [a, b]?"</p>
                    </div>

                    <div class="card">
                        <h4>Continuity on Intervals</h4>
                        <ul style="margin: 10px 0 0 20px;">
                            <li><strong>Open interval (a, b):</strong> Continuous at every point in the interval</li>
                            <li><strong>Closed interval [a, b]:</strong> Continuous on (a, b), right-continuous at a, left-continuous at b</li>
                        </ul>
                    </div>

                    <div class="exam-tip">
                        <div class="exam-tip-label">üí° EXAM TIP</div>
                        For rational functions \(\frac{p(x)}{q(x)}\), find where \(q(x) = 0\). The function is continuous everywhere except those points.
                    </div>

                    <div class="inline-practice">
                        <h4 class="inline-practice-title">Practice This Type</h4>
                        <div class="practice-problem">
                            <div class="practice-label">Practice Problem</div>
                            <div class="practice-question">On what interval is \(f(x) = \frac{1}{x^2 - 4}\) continuous?</div>
                            <div class="practice-options">
                                <div class="practice-option">\((-\infty, \infty)\)</div>
                                <div class="practice-option">\((-2, 2)\)</div>
                                <div class="practice-option" data-correct="true">\((-\infty, -2) \cup (-2, 2) \cup (2, \infty)\)</div>
                                <div class="practice-option">\([0, \infty)\)</div>
                            </div>
                            <div class="practice-feedback"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Type 5: Removing Discontinuities -->
            <div class="problem-type collapsed" id="problem-type-5">
                <div class="problem-type-header">
                    <span class="problem-type-title">Type 5: Removing Discontinuities</span>
                    <span class="difficulty-badge easy">Basic</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="problem-type-content">
                    <div class="pattern-box">
                        <div class="pattern-label">Recognition Pattern</div>
                        <p>"What value of f(a) would make f continuous?" or "Remove the discontinuity"</p>
                    </div>

                    <div class="worked-example">
                        <div class="example-title">Worked Example</div>
                        <div class="example-problem">
                            The function \(g(x) = \frac{x^2 - 9}{x - 3}\) has a discontinuity at \(x = 3\). What value should be assigned to \(g(3)\) to make \(g\) continuous?
                        </div>

                        <div class="animation-container" id="anim-remove">
                            <div class="animation-step" data-step="1">
                                <div class="step-number">Step 1: Find the limit</div>
                                <p>\(\lim_{x \to 3} \frac{x^2 - 9}{x - 3} = \lim_{x \to 3} \frac{(x-3)(x+3)}{x-3} = \lim_{x \to 3} (x+3) = 6\)</p>
                                <div class="step-reasoning">üí≠ Factor and cancel to find the limit.</div>
                            </div>
                            <div class="animation-step" data-step="2">
                                <div class="step-number">Step 2: Assign the value</div>
                                <p>For continuity, set \(g(3) = 6\)</p>
                                <div class="step-reasoning">üí≠ The limit exists, so we can remove the discontinuity by defining g(3) = limit.</div>
                            </div>
                            <div class="animation-controls">
                                <button class="control-btn" onclick="animPrev('anim-remove')">‚Üê Prev</button>
                                <button class="control-btn" onclick="animNext('anim-remove')">Next ‚Üí</button>
                                <div class="progress-bar"><div class="progress-fill" style="width: 50%"></div></div>
                                <span class="step-counter">Step 1 of 2</span>
                                <button class="control-btn" onclick="animReset('anim-remove')">Reset</button>
                            </div>
                        </div>
                    </div>

                    <div class="inline-practice">
                        <h4 class="inline-practice-title">Practice This Type</h4>
                        <div class="practice-problem">
                            <div class="practice-label">Practice Problem</div>
                            <div class="practice-question">The function \(h(x) = \frac{x^2 - 4x + 3}{x - 1}\) has a discontinuity at \(x = 1\). What value should \(h(1)\) be defined as to make \(h\) continuous?</div>
                            <div class="practice-options">
                                <div class="practice-option">0</div>
                                <div class="practice-option">1</div>
                                <div class="practice-option" data-correct="true">-2</div>
                                <div class="practice-option">Cannot be made continuous</div>
                            </div>
                            <div class="practice-feedback"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Exam Tips Section -->
        <section id="examtips" class="section">
            <h2 class="section-title">Exam Tips</h2>

            <div class="decision-flowchart">
                <div class="flowchart-title">Master Verification Checklist</div>
                <div class="flowchart-container">
                    <div class="flowchart-node question">Checking continuity at x = a?</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node answer">‚òê Check: Is f(a) defined?</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node answer">‚òê Check: Does lim exist? (left = right)</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node answer">‚òê Check: Does lim = f(a)?</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node success">All three YES ‚Üí Continuous ‚úì</div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Quick Reference</h3>

                <div class="exam-tip">
                    <div class="exam-tip-label">üí° TIP #1: Know Your Continuous Functions</div>
                    These are continuous on their domains: polynomials, trig functions, exponentials, logarithms, rational functions (except where denominator = 0).
                </div>

                <div class="exam-tip">
                    <div class="exam-tip-label">üí° TIP #2: Piecewise Strategy</div>
                    For piecewise functions, only check continuity at the boundary points. The individual pieces are usually continuous.
                </div>

                <div class="exam-tip">
                    <div class="exam-tip-label">üí° TIP #3: Removable vs. Non-Removable</div>
                    Only removable discontinuities can be "fixed." Jump and infinite discontinuities are permanent.
                </div>

                <div class="exam-tip">
                    <div class="exam-tip-label">üí° TIP #4: Two Parameters</div>
                    If asked to find TWO values (like k and m) for continuity, you need TWO equations. Set up: left limit = right limit AND the value equals both.
                </div>
            </div>
        </section>

        <!-- Common Mistakes Section -->
        <section id="mistakes" class="section">
            <h2 class="section-title">Common Mistakes</h2>

            <div class="mistake-item">
                <h4>Mistake #1: Only checking that the limit exists</h4>
                <div class="mistake-wrong">"The limit exists, so f is continuous" ‚úó</div>
                <div class="mistake-correct">
                    <strong>Correct:</strong> You must also verify that f(a) is defined AND equals the limit.<br>
                    All THREE conditions must be satisfied!
                </div>
            </div>

            <div class="mistake-item">
                <h4>Mistake #2: Confusing "limit exists" with "limit is finite"</h4>
                <div class="mistake-wrong">"lim = ‚àû, so the limit exists" ‚úó</div>
                <div class="mistake-correct">
                    <strong>Correct:</strong> If a limit is ‚àû, we say "the limit does not exist" (it's infinite).<br>
                    This creates an infinite discontinuity, not a removable one.
                </div>
            </div>

            <div class="mistake-item">
                <h4>Mistake #3: Using the wrong piece in piecewise functions</h4>
                <div class="mistake-wrong">For \(f(x) = \begin{cases} x^2 & x < 2 \\ 3x & x \geq 2 \end{cases}\), f(2) = 4 ‚úó</div>
                <div class="mistake-correct">
                    <strong>Correct:</strong> Since x = 2 satisfies x ‚â• 2, use the second piece: f(2) = 3(2) = 6
                </div>
                <div class="mistake-reason">
                    <strong>Why this happens:</strong> Students evaluate both pieces instead of checking which one applies at the specific x-value.
                </div>
            </div>

            <div class="mistake-item">
                <h4>Mistake #4: Thinking all discontinuities can be removed</h4>
                <div class="mistake-wrong">"I'll just define f(a) = L to fix any discontinuity" ‚úó</div>
                <div class="mistake-correct">
                    <strong>Correct:</strong> Only removable discontinuities (where the limit exists) can be fixed.<br>
                    Jump and infinite discontinuities cannot be removed by redefining a single point.
                </div>
            </div>
        </section>

        <!-- Connections Section -->
        <section id="connections" class="section">
            <h2 class="section-title">Forward Connections</h2>

            <div class="connection-card">
                <div class="connection-icon">üìê</div>
                <div class="connection-content">
                    <h4>U1.6 Intermediate Value Theorem (IVT)</h4>
                    <p>IVT requires continuity on a closed interval. Without continuity, IVT cannot be applied!</p>
                </div>
            </div>

            <div class="connection-card">
                <div class="connection-icon">üìà</div>
                <div class="connection-content">
                    <h4>U2.3 Differentiability</h4>
                    <p>Differentiability implies continuity. If a function is differentiable at a point, it must be continuous there.</p>
                </div>
            </div>

            <div class="connection-card">
                <div class="connection-icon">‚ö°</div>
                <div class="connection-content">
                    <h4>U5.1 Mean Value Theorem (MVT)</h4>
                    <p>MVT requires continuity on [a, b]. Checking continuity is often the first step in MVT problems.</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Self-Assessment Checklist</h3>
                <div class="checklist">
                    <div class="checklist-item">
                        <input type="checkbox" class="checklist-checkbox" id="check1">
                        <label for="check1">I can state the three conditions for continuity</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" class="checklist-checkbox" id="check2">
                        <label for="check2">I can identify removable, jump, and infinite discontinuities</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" class="checklist-checkbox" id="check3">
                        <label for="check3">I can find k to make a piecewise function continuous</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" class="checklist-checkbox" id="check4">
                        <label for="check4">I can determine intervals of continuity</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" class="checklist-checkbox" id="check5">
                        <label for="check5">I can remove discontinuities when possible</label>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Theme Toggle
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            document.querySelector('.theme-toggle').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            renderGraphs();
        }

        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);
        document.querySelector('.theme-toggle').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

        // Navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.getAttribute('data-section')).classList.add('active');
            });
        });

        // Prerequisites Toggle
        function togglePrereq(header) {
            const card = header.parentElement;
            card.classList.toggle('open');
            card.querySelector('.prereq-content').classList.toggle('active');
        }

        // Problem Type Accordion
        document.querySelectorAll('.problem-type .problem-type-header').forEach(header => {
            header.addEventListener('click', () => {
                const parent = header.parentElement;
                const wasCollapsed = parent.classList.contains('collapsed');
                document.querySelectorAll('.problem-type[id^="problem-type-"]').forEach(pt => pt.classList.add('collapsed'));
                if (wasCollapsed) parent.classList.remove('collapsed');
            });
        });

        // Animation System
        const animations = {};

        function initAnimation(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const steps = container.querySelectorAll('.animation-step');
            animations[containerId] = { currentStep: 1, totalSteps: steps.length };
            updateAnimation(containerId);
        }

        function updateAnimation(containerId) {
            const container = document.getElementById(containerId);
            const anim = animations[containerId];
            container.querySelectorAll('.animation-step').forEach((step, i) => {
                step.classList.toggle('active', i + 1 === anim.currentStep);
            });
            container.querySelector('.progress-fill').style.width = `${(anim.currentStep / anim.totalSteps) * 100}%`;
            container.querySelector('.step-counter').textContent = `Step ${anim.currentStep} of ${anim.totalSteps}`;
        }

        function animNext(id) { if (animations[id].currentStep < animations[id].totalSteps) { animations[id].currentStep++; updateAnimation(id); } }
        function animPrev(id) { if (animations[id].currentStep > 1) { animations[id].currentStep--; updateAnimation(id); } }
        function animReset(id) { animations[id].currentStep = 1; updateAnimation(id); }

        // Practice Problems
        document.querySelectorAll('.practice-option').forEach(option => {
            option.addEventListener('click', function() {
                const problem = this.closest('.practice-problem');
                problem.querySelectorAll('.practice-option').forEach(opt => opt.classList.remove('selected', 'correct', 'incorrect'));
                this.classList.add('selected');
                const feedback = problem.querySelector('.practice-feedback');
                if (this.getAttribute('data-correct') === 'true') {
                    this.classList.add('correct');
                    feedback.textContent = '‚úì Correct!';
                    feedback.className = 'practice-feedback show correct';
                } else {
                    this.classList.add('incorrect');
                    problem.querySelector('[data-correct="true"]').classList.add('correct');
                    feedback.textContent = '‚úó Not quite. See the correct answer.';
                    feedback.className = 'practice-feedback show incorrect';
                }
            });
        });

        // Render Mini Graphs
        function renderGraphs() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            const bgColor = isDark ? '#0f3460' : '#e9ecef';
            const textColor = isDark ? '#eef0f2' : '#212529';

            // Removable discontinuity
            const remDiv = document.getElementById('graph-removable');
            if (remDiv) {
                const x1 = [], y1 = [], x2 = [], y2 = [];
                for (let i = -2; i < 1; i += 0.1) { x1.push(i); y1.push(i + 1); }
                for (let i = 1.1; i <= 3; i += 0.1) { x2.push(i); y2.push(i + 1); }

                Plotly.newPlot('graph-removable', [
                    { x: x1, y: y1, type: 'scatter', mode: 'lines', line: { color: '#4361ee', width: 2 } },
                    { x: x2, y: y2, type: 'scatter', mode: 'lines', line: { color: '#4361ee', width: 2 } },
                    { x: [1], y: [2], type: 'scatter', mode: 'markers', marker: { color: bgColor, size: 10, line: { color: '#4361ee', width: 2 } } }
                ], {
                    xaxis: { visible: false }, yaxis: { visible: false },
                    margin: { t: 10, b: 10, l: 10, r: 10 },
                    paper_bgcolor: bgColor, plot_bgcolor: bgColor,
                    showlegend: false
                }, { responsive: true, displayModeBar: false });
            }

            // Jump discontinuity
            const jumpDiv = document.getElementById('graph-jump');
            if (jumpDiv) {
                const x1 = [], y1 = [], x2 = [], y2 = [];
                for (let i = -2; i < 1; i += 0.1) { x1.push(i); y1.push(1); }
                for (let i = 1; i <= 3; i += 0.1) { x2.push(i); y2.push(2); }

                Plotly.newPlot('graph-jump', [
                    { x: x1, y: y1, type: 'scatter', mode: 'lines', line: { color: '#4361ee', width: 2 } },
                    { x: x2, y: y2, type: 'scatter', mode: 'lines', line: { color: '#4361ee', width: 2 } },
                    { x: [1], y: [1], type: 'scatter', mode: 'markers', marker: { color: bgColor, size: 10, line: { color: '#4361ee', width: 2 } } },
                    { x: [1], y: [2], type: 'scatter', mode: 'markers', marker: { color: '#4361ee', size: 10 } }
                ], {
                    xaxis: { visible: false }, yaxis: { visible: false },
                    margin: { t: 10, b: 10, l: 10, r: 10 },
                    paper_bgcolor: bgColor, plot_bgcolor: bgColor,
                    showlegend: false
                }, { responsive: true, displayModeBar: false });
            }

            // Infinite discontinuity
            const infDiv = document.getElementById('graph-infinite');
            if (infDiv) {
                const x1 = [], y1 = [], x2 = [], y2 = [];
                for (let i = -2; i < -0.1; i += 0.1) { x1.push(i); y1.push(1/i); }
                for (let i = 0.1; i <= 2; i += 0.1) { x2.push(i); y2.push(1/i); }

                Plotly.newPlot('graph-infinite', [
                    { x: x1, y: y1, type: 'scatter', mode: 'lines', line: { color: '#4361ee', width: 2 } },
                    { x: x2, y: y2, type: 'scatter', mode: 'lines', line: { color: '#4361ee', width: 2 } }
                ], {
                    xaxis: { visible: false }, yaxis: { visible: false, range: [-5, 5] },
                    margin: { t: 10, b: 10, l: 10, r: 10 },
                    paper_bgcolor: bgColor, plot_bgcolor: bgColor,
                    showlegend: false
                }, { responsive: true, displayModeBar: false });
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '\\[', right: '\\]', display: true},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError: false
            });

            initAnimation('anim-three-condition');
            initAnimation('anim-find-k');
            initAnimation('anim-remove');
            renderGraphs();
        });

        // Practice Problem Handler
        document.querySelectorAll('.practice-option').forEach(option => {
            option.addEventListener('click', function() {
                const problem = this.closest('.practice-problem');
                const options = problem.querySelectorAll('.practice-option');
                const feedback = problem.querySelector('.practice-feedback');

                options.forEach(opt => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                });

                this.classList.add('selected');

                const isCorrect = this.getAttribute('data-correct') === 'true';

                if (isCorrect) {
                    this.classList.add('correct');
                    feedback.textContent = '‚úì Correct! Great work.';
                    feedback.className = 'practice-feedback show correct';
                } else {
                    this.classList.add('incorrect');
                    const correctOption = problem.querySelector('[data-correct="true"]');
                    correctOption.classList.add('correct');
                    feedback.textContent = '‚úó Not quite. The correct answer is highlighted.';
                    feedback.className = 'practice-feedback show incorrect';
                }
            });
        });

        // ============================================
        // TRANSLATION FEATURE
        // ============================================
        const TRANSLATION_CONFIG = {
            endpoint: 'https://test-3gop834c099077bf-1302819770.ap-shanghai.app.tcloudbase.com/api/translate',
            maxLength: 2000
        };

        async function translateToChinese(text) {
            if (text.length > TRANSLATION_CONFIG.maxLength) {
                text = text.substring(0, TRANSLATION_CONFIG.maxLength);
            }

            const response = await fetch(TRANSLATION_CONFIG.endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text, source: 'auto', target: 'zh' })
            });

            if (!response.ok) {
                throw new Error(`Translation failed: ${response.status}`);
            }

            const data = await response.json();
            return data.translation;
        }

        let translatePopup = null;

        function clearTranslatePopup() {
            if (translatePopup) {
                translatePopup.remove();
                translatePopup = null;
            }
        }

        function createTranslatePopup(selectedText, rect) {
            clearTranslatePopup();

            const popup = document.createElement('div');
            popup.className = 'translate-popup';
            popup.id = 'translate-popup';

            const scrollTop = window.scrollY;
            const scrollLeft = window.scrollX;
            const spaceAbove = rect.top;
            const showBelow = spaceAbove < 70;

            let top = showBelow
                ? rect.bottom + scrollTop + 12
                : rect.top + scrollTop - 60;
            let left = rect.left + scrollLeft + (rect.width / 2);

            const viewportWidth = window.innerWidth;
            left = Math.max(100, Math.min(left, viewportWidth - 100));

            if (showBelow) popup.classList.add('below');

            popup.style.cssText = `
                position: absolute;
                top: ${top}px;
                left: ${left}px;
                transform: translateX(-50%);
            `;

            popup.innerHTML = `
                <button class="translate-btn" id="do-translate">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 8l6 6M4 14h6v6M15 4h5v5M14.5 4l5 5"/>
                        <path d="M2 5h12M9 2v6"/>
                    </svg>
                    ÁøªËØëÊàê‰∏≠Êñá
                </button>
            `;

            document.body.appendChild(popup);
            translatePopup = popup;

            popup.querySelector('#do-translate').addEventListener('click', async () => {
                const btn = popup.querySelector('#do-translate');
                btn.disabled = true;
                btn.textContent = 'ÁøªËØë‰∏≠...';

                try {
                    const translation = await translateToChinese(selectedText);
                    btn.style.display = 'none';

                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'translation-result';
                    resultDiv.textContent = translation;
                    popup.appendChild(resultDiv);

                    if (!showBelow) {
                        const newHeight = popup.offsetHeight;
                        popup.style.top = `${rect.top + scrollTop - newHeight - 12}px`;
                    }
                } catch (error) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'translation-result translation-error';
                    errorDiv.textContent = 'ÁøªËØëÂ§±Ë¥•ÔºåËØ∑ÈáçËØï';
                    popup.appendChild(errorDiv);
                    btn.style.display = 'none';
                }
            });
        }

        function handleTextSelection() {
            setTimeout(() => {
                const selection = window.getSelection();
                const selectedText = selection.toString().trim();

                if (selectedText.length > 0 && selectedText.length < 5000) {
                    const range = selection.getRangeAt(0);
                    const rect = range.getBoundingClientRect();
                    createTranslatePopup(selectedText, rect);
                }
            }, 10);
        }

        (function initTranslation() {
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            if (isTouchDevice) return;

            document.addEventListener('mouseup', (e) => {
                if (e.target.closest('#translate-popup')) return;
                handleTextSelection();
            });

            document.addEventListener('mousedown', (e) => {
                if (!e.target.closest('#translate-popup')) {
                    clearTranslatePopup();
                }
            });

            document.addEventListener('selectstart', clearTranslatePopup);
            document.addEventListener('scroll', clearTranslatePopup);
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    clearTranslatePopup();
                    window.getSelection().removeAllRanges();
                }
            });
        })();
    </script>

    <!-- Tencent CloudBase JS SDK -->
    <script src="https://static.cloudbase.net/cloudbase-js-sdk/latest/cloudbase.full.js"></script>

    <!-- Custom Annotation System -->
    <script src="lib/annotation.js"></script>
</body>
</html>
