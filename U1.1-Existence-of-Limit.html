<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U1.1 Existence of Limit - AP Calculus BC</title>

    <!-- KaTeX for mathematical notation -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Plotly.js for graphs -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /*
         * CSS Variables - aligned with design-specs.md naming convention
         * Mappings: --bg-primary = --background, --bg-secondary = --background-secondary,
         * --accent-primary = --accent, --accent-success = --success, --accent-danger = --error
         */
        :root {
            /* Primary colors (design-specs: --background, --background-secondary) */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --accent-primary: #3b82f6;
            --accent-secondary: #8b5cf6;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border-color: #475569;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 40px 20px;
            border-radius: var(--radius-lg);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 60%;
            height: 200%;
            background: rgba(255,255,255,0.1);
            transform: rotate(15deg);
        }

        .header-content { position: relative; z-index: 1; }

        .unit-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; }

        .header-meta { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; }

        .meta-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(255,255,255,0.2);
            padding: 8px 14px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-md);
        }

        .theme-toggle:hover { transform: scale(1.1); }
        .theme-toggle svg { width: 24px; height: 24px; fill: var(--text-primary); }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .nav-tab:hover { background: var(--bg-tertiary); }

        .nav-tab.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        /* Sections */
        .section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title .icon {
            width: 36px;
            height: 36px;
            background: var(--accent-primary);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        /* Learning Objectives */
        .objectives-list {
            list-style: none;
            padding: 0;
        }

        .objectives-list li {
            padding: 12px 15px;
            margin: 8px 0;
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-primary);
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .objectives-list li::before {
            content: '‚úì';
            color: var(--accent-success);
            font-weight: 700;
        }

        /* Prerequisites */
        .prereq-card {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 20px;
        }

        .prereq-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .prereq-title { font-weight: 600; font-size: 1.1rem; }

        .prereq-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-danger);
        }

        .expand-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
        }

        .prereq-lesson { display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color); }
        .prereq-lesson.expanded { display: block; }

        /* Graph Container */
        .graph-container {
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            padding: 20px;
            margin: 20px 0;
        }

        .graph-plot { width: 100%; height: 350px; }

        /* Animation Controls */
        .animation-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--accent-primary);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover { transform: scale(1.1); }
        .control-btn:disabled { background: var(--text-muted); cursor: not-allowed; }
        .control-btn svg { width: 18px; height: 18px; }

        .step-counter { font-weight: 600; color: var(--text-secondary); min-width: 90px; text-align: center; }

        .progress-bar { flex: 1; height: 6px; background: var(--bg-primary); border-radius: 3px; overflow: hidden; min-width: 100px; }
        .progress-fill { height: 100%; background: var(--accent-primary); transition: width 0.3s; }

        .speed-control { display: flex; align-items: center; gap: 6px; margin-left: auto; }

        .speed-btn {
            padding: 5px 10px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 12px;
            color: var(--text-primary);
        }

        .speed-btn.active { background: var(--accent-primary); color: white; border-color: var(--accent-primary); }

        /* Step Display */
        .step-display {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 20px 0;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--accent-primary);
            color: white;
            border-radius: 50%;
            font-weight: 700;
            margin-right: 10px;
            font-size: 14px;
        }

        .step-content { font-size: 1.05rem; margin-top: 12px; }

        .step-reasoning {
            background: rgba(139, 92, 246, 0.1);
            border-left: 4px solid var(--accent-secondary);
            padding: 15px;
            margin-top: 15px;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        .step-reasoning-title { font-weight: 600; color: var(--accent-secondary); margin-bottom: 8px; }

        /* Prediction Mode */
        .prediction-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 2px dashed var(--accent-primary);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }

        .prediction-question { font-size: 1.15rem; font-weight: 600; margin-bottom: 20px; }

        .prediction-options { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 20px; }

        .prediction-option {
            padding: 12px 24px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .prediction-option:hover { border-color: var(--accent-primary); background: rgba(59, 130, 246, 0.1); }
        .prediction-option.selected { border-color: var(--accent-primary); background: var(--accent-primary); color: white; }
        .prediction-option.correct { border-color: var(--accent-success); background: var(--accent-success); color: white; }
        .prediction-option.incorrect { border-color: var(--accent-danger); background: rgba(239, 68, 68, 0.1); }

        .prediction-submit {
            padding: 12px 32px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
        }

        .prediction-feedback { margin-top: 20px; padding: 15px; border-radius: var(--radius-md); font-weight: 500; }
        .prediction-feedback.correct { background: rgba(16, 185, 129, 0.15); color: var(--accent-success); }
        .prediction-feedback.incorrect { background: rgba(239, 68, 68, 0.15); color: var(--accent-danger); }

        /* Problem Types */
        .problem-type {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
        }

        .problem-type-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .problem-type-title { font-size: 1.2rem; font-weight: 700; }

        .difficulty-badge { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .difficulty-badge.easy { background: rgba(16, 185, 129, 0.15); color: var(--accent-success); }
        .difficulty-badge.medium { background: rgba(245, 158, 11, 0.15); color: var(--accent-warning); }
        .difficulty-badge.hard { background: rgba(239, 68, 68, 0.15); color: var(--accent-danger); }

        .pattern-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: var(--radius-md);
            padding: 20px;
            margin: 15px 0;
        }

        .pattern-title { font-weight: 600; color: var(--accent-primary); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }

        .exam-tip {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--accent-warning);
            padding: 15px 20px;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            margin: 15px 0;
        }

        .exam-tip-label { font-weight: 700; color: var(--accent-warning); display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }

        /* Practice Problems */
        .practice-problem {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 20px;
            margin: 15px 0;
        }

        .practice-problem-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .practice-number { font-weight: 700; color: var(--accent-primary); }

        .answer-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 16px;
            background: var(--bg-primary);
            color: var(--text-primary);
            margin: 10px 0;
        }

        .answer-input:focus { outline: none; border-color: var(--accent-primary); }

        .check-answer-btn {
            padding: 10px 24px;
            background: var(--accent-success);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
        }

        .show-solution-btn {
            padding: 10px 24px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-weight: 500;
            cursor: pointer;
        }

        .solution-display {
            display: none;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-top: 15px;
        }

        .solution-display.visible { display: block; }

        /* Level System */
        .level-section { margin-top: 30px; }

        .level-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }

        .level-badge { padding: 8px 20px; border-radius: var(--radius-md); font-weight: 700; }
        .level-badge.level-1 { background: var(--accent-success); color: white; }
        .level-badge.level-2 { background: var(--accent-warning); color: white; }
        .level-badge.level-3 { background: var(--accent-danger); color: white; }
        .level-badge.locked { background: var(--text-muted); color: white; opacity: 0.7; }

        .level-locked-msg {
            padding: 20px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            text-align: center;
            color: var(--text-muted);
            border: 2px dashed var(--border-color);
        }

        /* Mistake Cards */
        .mistake-card {
            background: rgba(239, 68, 68, 0.05);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: var(--radius-md);
            padding: 20px;
            margin: 15px 0;
        }

        .mistake-wrong { text-decoration: line-through; color: var(--accent-danger); opacity: 0.7; }
        .mistake-correct { color: var(--accent-success); font-weight: 600; }
        .mistake-why { margin-top: 10px; color: var(--text-secondary); font-style: italic; }

        /* Connections */
        .connection-card {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 20px;
            margin: 10px 0;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .connection-card:hover { transform: translateX(5px); }

        .connection-preview {
            margin-top: 15px;
            padding: 15px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
        }

        /* Assessment */
        .assessment-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin: 10px 0;
            cursor: pointer;
        }

        .assessment-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .assessment-checkbox.checked { background: var(--accent-success); border-color: var(--accent-success); }
        .assessment-checkbox.checked::after { content: '‚úì'; color: white; font-weight: 700; }

        /* Math Display */
        .math-display { text-align: center; padding: 20px; font-size: 1.2rem; }

        /* Tables */
        .limit-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .limit-table th, .limit-table td { padding: 12px 16px; text-align: center; border-bottom: 1px solid var(--border-color); }
        .limit-table th { background: var(--accent-primary); color: white; font-weight: 600; }
        .limit-table tr:hover { background: var(--bg-tertiary); }
        .highlight-cell { background: rgba(59, 130, 246, 0.2) !important; font-weight: 600; }

        /* Definition Box */
        .definition-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.05));
            border: 2px solid var(--accent-primary);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 20px 0;
        }

        .definition-title { font-size: 1.1rem; font-weight: 700; color: var(--accent-primary); margin-bottom: 15px; }

        /* Concept Cards */
        .concept-visual { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin: 20px 0; }

        .concept-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
        }

        .concept-icon { font-size: 2.5rem; margin-bottom: 12px; }
        .concept-title { font-weight: 700; margin-bottom: 8px; }
        .concept-description { color: var(--text-secondary); font-size: 0.9rem; }

        /* Exam Tips Summary */
        .tips-summary {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(239, 68, 68, 0.05));
            border: 2px solid var(--accent-warning);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin: 20px 0;
        }

        .tips-summary h3 { color: var(--accent-warning); margin-bottom: 15px; }

        .tips-summary ul { padding-left: 20px; }
        .tips-summary li { margin: 12px 0; }

        /* Content panels */
        .content-panel { display: none; }
        .content-panel.active { display: block; }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .header-meta { flex-direction: column; gap: 10px; }
            .animation-controls { flex-direction: column; align-items: stretch; }
            .speed-control { margin-left: 0; justify-content: center; }
            .prediction-options { flex-direction: column; }
            .prediction-option { width: 100%; }
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.3s ease-out; }

        /* Progress tracker */
        .progress-tracker {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 15px;
            box-shadow: var(--shadow-lg);
            z-index: 999;
        }

        .progress-tracker-title { font-size: 12px; color: var(--text-muted); margin-bottom: 8px; }
        .progress-tracker-bar { width: 150px; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; }
        .progress-tracker-fill { height: 100%; background: var(--accent-success); transition: width 0.3s; }
        .progress-tracker-text { font-size: 12px; margin-top: 5px; text-align: center; font-weight: 600; }

        /* ========== METHOD SELECTION FRAMEWORK ========== */
        .method-framework {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(139, 92, 246, 0.05));
            border: 2px solid var(--accent-primary);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin: 25px 0;
        }

        .method-framework-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .when-to-use { margin-bottom: 20px; }

        .use-case {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px 15px;
            margin: 8px 0;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
        }

        .use-case-icon { font-size: 1.2rem; flex-shrink: 0; }
        .use-case-icon.do { color: var(--accent-success); }
        .use-case-icon.dont { color: var(--accent-danger); }
        .use-case-text { color: var(--text-primary); line-height: 1.5; }

        .decision-flowchart {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 25px;
            margin-top: 20px;
        }

        .flowchart-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .flowchart-container { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .flowchart-node {
            padding: 15px 25px;
            border-radius: var(--radius-md);
            text-align: center;
            max-width: 350px;
            width: 100%;
        }

        .flowchart-node.question {
            background: rgba(59, 130, 246, 0.15);
            border: 2px solid var(--accent-primary);
            font-weight: 600;
        }

        .flowchart-node.answer {
            background: rgba(16, 185, 129, 0.15);
            border: 2px solid var(--accent-success);
            color: var(--accent-success);
            font-weight: 600;
        }

        .flowchart-arrow {
            color: var(--text-muted);
            font-size: 1.5rem;
        }

        .flowchart-branch {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .flowchart-branch-item { text-align: center; }

        .flowchart-branch-label {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 10px;
            display: inline-block;
        }

        .flowchart-branch-label.yes { background: rgba(16, 185, 129, 0.2); color: var(--accent-success); }
        .flowchart-branch-label.no { background: rgba(239, 68, 68, 0.2); color: var(--accent-danger); }

        /* ========== PREDICTION MODAL ========== */
        .prediction-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .prediction-modal-overlay.active { opacity: 1; visibility: visible; }

        .prediction-modal {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .prediction-modal-overlay.active .prediction-modal { transform: scale(1); }

        .prediction-modal-header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 20px;
        }

        .prediction-modal-header h3 { font-size: 1.1rem; margin-bottom: 8px; }

        .prediction-modal-context {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: var(--radius-sm);
            font-family: 'SF Mono', monospace;
            font-size: 0.9rem;
        }

        .prediction-modal-body { padding: 25px; }

        .prediction-modal-question {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .prediction-modal-options { display: flex; flex-direction: column; gap: 10px; }

        .prediction-modal-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-primary);
        }

        .prediction-modal-option:hover { border-color: var(--accent-primary); background: rgba(59, 130, 246, 0.05); }
        .prediction-modal-option.selected { border-color: var(--accent-primary); background: rgba(59, 130, 246, 0.1); }
        .prediction-modal-option.correct { border-color: var(--accent-success); background: rgba(16, 185, 129, 0.15); }
        .prediction-modal-option.incorrect { border-color: var(--accent-danger); background: rgba(239, 68, 68, 0.1); opacity: 0.7; }

        .prediction-modal-letter {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }

        .prediction-modal-option.selected .prediction-modal-letter { background: var(--accent-primary); color: white; }

        .prediction-modal-submit {
            width: 100%;
            padding: 14px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.2s;
        }

        .prediction-modal-submit:hover { background: #2563eb; }
        .prediction-modal-submit:disabled { opacity: 0.5; cursor: not-allowed; }

        .prediction-modal-feedback {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .prediction-modal-feedback.show { display: block; }
        .prediction-modal-feedback.correct { background: rgba(16, 185, 129, 0.1); }
        .prediction-modal-feedback.incorrect { background: rgba(239, 68, 68, 0.1); }

        .feedback-icon { font-size: 2rem; margin-bottom: 10px; }
        .feedback-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; }
        .prediction-modal-feedback.correct .feedback-title { color: var(--accent-success); }
        .prediction-modal-feedback.incorrect .feedback-title { color: var(--accent-danger); }
        .feedback-explanation { color: var(--text-secondary); line-height: 1.6; }

        .prediction-modal-continue {
            margin-top: 15px;
            padding: 10px 24px;
            background: var(--text-primary);
            color: var(--bg-primary);
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
        }

        /* ========== FREQUENCY BADGES ========== */
        .freq-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .freq-badge.high-priority {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(245, 158, 11, 0.2));
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.4);
        }

        .freq-badge.standard {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .freq-badge.rarely-tested {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-muted);
            font-style: italic;
        }

        /* ========== ENHANCED PATTERN BOX ========== */
        .pattern-do, .pattern-dont {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: var(--radius-sm);
        }

        .pattern-do {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid var(--accent-success);
        }

        .pattern-dont {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid var(--accent-danger);
        }

        .pattern-icon { font-size: 1rem; flex-shrink: 0; margin-top: 2px; }
        .pattern-do .pattern-icon { color: var(--accent-success); }
        .pattern-dont .pattern-icon { color: var(--accent-danger); }

        /* ========== PREREQ PRACTICE ========== */
        .prereq-practice {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-top: 20px;
        }

        .prereq-practice-title {
            font-weight: 600;
            color: var(--accent-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .prereq-quick-q {
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            margin: 10px 0;
        }

        .prereq-quick-q p { margin-bottom: 12px; }

        .prereq-options { display: flex; flex-wrap: wrap; gap: 10px; }

        .prereq-opt {
            padding: 8px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s;
        }

        .prereq-opt:hover { border-color: var(--accent-primary); }
        .prereq-opt.selected { background: var(--accent-primary); color: white; border-color: var(--accent-primary); }
        .prereq-opt.correct { background: var(--accent-success); color: white; border-color: var(--accent-success); }
        .prereq-opt.wrong { background: rgba(239, 68, 68, 0.2); border-color: var(--accent-danger); }

        .need-more-help {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: transparent;
            border: 1px dashed var(--accent-secondary);
            color: var(--accent-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 20px;
            transition: all 0.2s;
        }

        .need-more-help:hover { background: rgba(139, 92, 246, 0.1); }

        .extended-lesson {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: rgba(139, 92, 246, 0.05);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: var(--radius-md);
        }

        .extended-lesson.visible { display: block; }

        /* ========== PRACTICE TYPE HEADERS ========== */
        .practice-type-header {
            background: linear-gradient(90deg, var(--accent-primary), transparent);
            color: white;
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            margin: 25px 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .practice-type-header .type-num {
            background: rgba(255,255,255,0.3);
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 12px;
        }

        /* ========== ACCESSIBILITY: FOCUS STATES ========== */
        *:focus { outline: none; }

        *:focus-visible {
            outline: 3px solid var(--accent-primary);
            outline-offset: 2px;
            border-radius: 4px;
        }

        button:focus-visible,
        .control-btn:focus-visible,
        .nav-tab:focus-visible,
        .expand-btn:focus-visible,
        .prediction-option:focus-visible,
        .prereq-opt:focus-visible {
            outline: 3px solid var(--accent-primary);
            outline-offset: 2px;
            box-shadow: 0 0 0 6px rgba(59, 130, 246, 0.2);
        }

        input:focus-visible,
        .answer-input:focus-visible {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }

        .assessment-item:focus-visible {
            outline: 3px solid var(--accent-primary);
            outline-offset: 2px;
        }

        /* Skip link for keyboard users */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent-primary);
            color: white;
            padding: 8px 16px;
            z-index: 9999;
            border-radius: var(--radius-sm);
            font-weight: 600;
            transition: top 0.3s;
        }

        .skip-link:focus { top: 10px; }

        /* ========== ACCESSIBILITY: REDUCED MOTION ========== */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }

            .header::before { display: none; }
            .fade-in { animation: none; }

            .control-btn:hover,
            .theme-toggle:hover,
            .nav-tab:hover,
            .prediction-option:hover,
            .prereq-opt:hover { transform: none; }

            .progress-fill,
            .progress-tracker-fill,
            .level-progress-fill { transition: none; }

            .prediction-modal-overlay,
            .prediction-modal { transition: none; }

            .prediction-modal-overlay.active .prediction-modal { transform: scale(1); }
        }

        /* ========== ACCESSIBILITY: HIGH CONTRAST ========== */
        @media (prefers-contrast: high) {
            :root { --border-color: #000000; }
            [data-theme="dark"] { --border-color: #ffffff; }

            .pattern-box, .exam-tip, .definition-box, .step-reasoning { border-width: 2px; }
            .difficulty-badge, .freq-badge, .level-badge { border: 2px solid currentColor; }
        }
    </style>
</head>
<body>
    <!-- Skip Link for Keyboard Navigation -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
        <svg class="sun-icon" viewBox="0 0 24 24" style="display: none;"><path d="M12 7a5 5 0 100 10 5 5 0 000-10zM2 13h2a1 1 0 100-2H2a1 1 0 100 2zm18 0h2a1 1 0 100-2h-2a1 1 0 100 2zM11 2v2a1 1 0 102 0V2a1 1 0 10-2 0zm0 18v2a1 1 0 102 0v-2a1 1 0 10-2 0zM5.99 4.58a1 1 0 00-1.41 1.41l1.06 1.06a1 1 0 101.41-1.41L5.99 4.58zm12.37 12.37a1 1 0 00-1.41 1.41l1.06 1.06a1 1 0 101.41-1.41l-1.06-1.06zm1.06-10.96a1 1 0 00-1.41-1.41l-1.06 1.06a1 1 0 101.41 1.41l1.06-1.06zM7.05 18.36a1 1 0 00-1.41-1.41l-1.06 1.06a1 1 0 101.41 1.41l1.06-1.06z"/></svg>
        <svg class="moon-icon" viewBox="0 0 24 24"><path d="M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/></svg>
    </button>

    <!-- Progress Tracker -->
    <div class="progress-tracker" id="progress-tracker">
        <div class="progress-tracker-title">LEVEL PROGRESS</div>
        <div class="progress-tracker-bar">
            <div class="progress-tracker-fill" id="level-progress-fill" style="width: 0%"></div>
        </div>
        <div class="progress-tracker-text" id="level-progress-text">0 / 6 correct</div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <span class="unit-badge">UNIT 1: LIMITS AND CONTINUITY</span>
                <h1>U1.1 Existence of Limit</h1>
                <p style="opacity: 0.9; font-size: 1.1rem;">Master the foundational concept that makes calculus possible</p>

                <div class="header-meta">
                    <span class="meta-badge">üìö CB Topics: 1.1, 1.2, 1.3, 1.4</span>
                    <span class="meta-badge" style="background: rgba(239,68,68,0.3);">üî• MCQ Count: 19</span>
                    <span class="meta-badge">‚ö° Difficulty: Low</span>
                    <span class="meta-badge">üéØ Frequency: Medium</span>
                    <span class="meta-badge">‚è±Ô∏è ~45 min</span>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav id="main-content" class="nav-tabs">
            <button class="nav-tab active" onclick="showPanel('objectives')">üéØ Objectives</button>
            <button class="nav-tab" onclick="showPanel('prerequisites')">üìã Prerequisites</button>
            <button class="nav-tab" onclick="showPanel('concepts')">üí° Concepts</button>
            <button class="nav-tab" onclick="showPanel('problems')">üìù Problem Types</button>
            <button class="nav-tab" onclick="showPanel('practice')">‚úèÔ∏è Practice</button>
            <button class="nav-tab" onclick="showPanel('tips')">üí° Exam Tips</button>
            <button class="nav-tab" onclick="showPanel('mistakes')">‚ö†Ô∏è Mistakes</button>
            <button class="nav-tab" onclick="showPanel('connections')">üîó Connections</button>
        </nav>

        <!-- ==================== LEARNING OBJECTIVES ==================== -->
        <div id="objectives" class="content-panel active">
            <section class="section">
                <h2 class="section-title"><span class="icon">üéØ</span> Learning Objectives</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">After completing this unit, you will be able to:</p>

                <ul class="objectives-list">
                    <li>Estimate limit values from graphs by analyzing left-hand and right-hand behavior</li>
                    <li>Estimate limit values from tables of function values</li>
                    <li>Determine when a limit does not exist and explain why (jump, infinity, or oscillation)</li>
                    <li>Use proper limit notation including one-sided limits (\(x \to a^-\) and \(x \to a^+\))</li>
                    <li>Distinguish between the limit of a function at a point and the value of the function at that point</li>
                </ul>

                <div class="definition-box" style="margin-top: 30px;">
                    <div class="definition-title">üìñ The Big Idea</div>
                    <p>A <strong>limit</strong> describes where a function is <em>heading</em> as x approaches a value‚Äînot where it actually is. This subtle distinction is the foundation of all calculus.</p>
                    <div class="math-display">\(\displaystyle\lim_{x \to a} f(x) = L\)</div>
                    <p style="text-align: center; color: var(--text-secondary);">"As x gets arbitrarily close to a, f(x) gets arbitrarily close to L"</p>
                </div>
            </section>
        </div>

        <!-- ==================== PREREQUISITES ==================== -->
        <div id="prerequisites" class="content-panel">
            <section class="section">
                <h2 class="section-title"><span class="icon">üìã</span> Prerequisites</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Master these foundational concepts before proceeding.</p>

                <!-- Prereq 1: Graph Tracking -->
                <div class="prereq-card">
                    <div class="prereq-header">
                        <span class="prereq-title">üìà Graph Tracking</span>
                        <span class="prereq-status">Required</span>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Following a function's behavior visually as x approaches a specific value.</p>
                    <button class="expand-btn" onclick="togglePrereq('graphs')">Review This Concept</button>

                    <div class="prereq-lesson" id="prereq-graphs-lesson">
                        <h4>What is Graph Tracking?</h4>
                        <p style="margin: 15px 0;">Graph tracking means tracing the curve to see where it's <strong>heading</strong>‚Äîlike following a road to see where it leads, even if you never reach the destination.</p>

                        <div class="concept-visual">
                            <div class="concept-card">
                                <div class="concept-icon">üëà</div>
                                <div class="concept-title">From the Left (x ‚Üí a‚Åª)</div>
                                <div class="concept-description">Approach using x-values smaller than a</div>
                            </div>
                            <div class="concept-card">
                                <div class="concept-icon">üëâ</div>
                                <div class="concept-title">From the Right (x ‚Üí a‚Å∫)</div>
                                <div class="concept-description">Approach using x-values larger than a</div>
                            </div>
                        </div>

                        <div class="graph-container">
                            <div id="prereq-graph-1" class="graph-plot"></div>
                        </div>

                        <div class="exam-tip">
                            <div class="exam-tip-label">üí° Key Insight</div>
                            When tracking, focus on WHERE the curve is heading, not where it actually IS at that point.
                        </div>

                        <!-- Quick Practice -->
                        <div class="prereq-practice">
                            <div class="prereq-practice-title">‚úì Quick Check: Do You Understand?</div>

                            <div class="prereq-quick-q" id="prereq-q1">
                                <p>Looking at the graph above, as x approaches 2, the y-value is heading toward:</p>
                                <div class="prereq-options">
                                    <span class="prereq-opt" onclick="checkPrereqAns('q1', this, false)">0</span>
                                    <span class="prereq-opt" onclick="checkPrereqAns('q1', this, true)">2</span>
                                    <span class="prereq-opt" onclick="checkPrereqAns('q1', this, false)">4</span>
                                    <span class="prereq-opt" onclick="checkPrereqAns('q1', this, false)">DNE</span>
                                </div>
                                <p id="prereq-q1-feedback" style="margin-top: 10px; display: none;"></p>
                            </div>

                            <div class="prereq-quick-q" id="prereq-q2">
                                <p>To find where a function is "heading," you should look at:</p>
                                <div class="prereq-options">
                                    <span class="prereq-opt" onclick="checkPrereqAns('q2', this, false)">The function value at the point</span>
                                    <span class="prereq-opt" onclick="checkPrereqAns('q2', this, true)">The behavior as x gets close</span>
                                    <span class="prereq-opt" onclick="checkPrereqAns('q2', this, false)">The y-intercept</span>
                                </div>
                                <p id="prereq-q2-feedback" style="margin-top: 10px; display: none;"></p>
                            </div>
                        </div>

                        <button class="need-more-help" onclick="toggleExtendedLesson('graphs-ext')">
                            üìö I need more help with this concept
                        </button>

                        <div class="extended-lesson" id="graphs-ext">
                            <h4>Extended Lesson: Graph Tracking Step-by-Step</h4>
                            <p style="margin: 15px 0;">Let's break down graph tracking into a simple 3-step process:</p>
                            <ol style="padding-left: 20px; line-height: 2;">
                                <li><strong>Find the x-value</strong> ‚Äî Locate the vertical line at x = a</li>
                                <li><strong>Trace from the left</strong> ‚Äî Follow the curve using x-values just below a</li>
                                <li><strong>Trace from the right</strong> ‚Äî Follow the curve using x-values just above a</li>
                            </ol>
                            <p style="margin-top: 15px;">The key is to <em>never look at the point itself</em>‚Äîonly where the curve is heading toward that point.</p>
                            <div class="exam-tip" style="margin-top: 15px;">
                                <div class="exam-tip-label">üéØ Memory Trick</div>
                                Think of it like GPS navigation: "In 100 meters, your destination is on the right" ‚Äî you see where you're <em>going</em>, not where you are!
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Prereq 2: Graph Features -->
                <div class="prereq-card">
                    <div class="prereq-header">
                        <span class="prereq-title">üìâ Special Graph Features</span>
                        <span class="prereq-status">Required</span>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Understanding holes, jumps, and asymptotes on function graphs.</p>
                    <button class="expand-btn" onclick="togglePrereq('features')">Review This Concept</button>

                    <div class="prereq-lesson" id="prereq-features-lesson">
                        <h4>Special Features That Affect Limits</h4>

                        <div class="concept-visual">
                            <div class="concept-card">
                                <div class="concept-icon">‚≠ï</div>
                                <div class="concept-title">Hole (Removable)</div>
                                <div class="concept-description">Single point missing. Limit still exists!</div>
                            </div>
                            <div class="concept-card">
                                <div class="concept-icon">üìç</div>
                                <div class="concept-title">Jump</div>
                                <div class="concept-description">Function jumps. Left ‚â† Right limit.</div>
                            </div>
                            <div class="concept-card">
                                <div class="concept-icon">üìà</div>
                                <div class="concept-title">Asymptote</div>
                                <div class="concept-description">Function ‚Üí ‚àû. May be ¬±‚àû or DNE.</div>
                            </div>
                        </div>

                        <div class="graph-container">
                            <div id="prereq-graph-2" class="graph-plot"></div>
                        </div>

                        <div class="definition-box">
                            <div class="definition-title">üìå Graph Notation</div>
                            <p><strong>‚óã (Open circle)</strong> = Point NOT included (hole or excluded endpoint)</p>
                            <p><strong>‚óè (Filled circle)</strong> = Point IS included (function value exists)</p>
                        </div>

                        <!-- Quick Practice -->
                        <div class="prereq-practice">
                            <div class="prereq-practice-title">‚úì Quick Check: Do You Understand?</div>

                            <div class="prereq-quick-q" id="prereq-q3">
                                <p>At a hole in the graph, the limit:</p>
                                <div class="prereq-options">
                                    <span class="prereq-opt" onclick="checkPrereqAns('q3', this, false)">Does not exist (DNE)</span>
                                    <span class="prereq-opt" onclick="checkPrereqAns('q3', this, true)">Can still exist</span>
                                    <span class="prereq-opt" onclick="checkPrereqAns('q3', this, false)">Equals infinity</span>
                                </div>
                                <p id="prereq-q3-feedback" style="margin-top: 10px; display: none;"></p>
                            </div>

                            <div class="prereq-quick-q" id="prereq-q4">
                                <p>A jump discontinuity causes the two-sided limit to:</p>
                                <div class="prereq-options">
                                    <span class="prereq-opt" onclick="checkPrereqAns('q4', this, false)">Equal the average</span>
                                    <span class="prereq-opt" onclick="checkPrereqAns('q4', this, true)">Not exist (DNE)</span>
                                    <span class="prereq-opt" onclick="checkPrereqAns('q4', this, false)">Equal the function value</span>
                                </div>
                                <p id="prereq-q4-feedback" style="margin-top: 10px; display: none;"></p>
                            </div>
                        </div>

                        <button class="need-more-help" onclick="toggleExtendedLesson('features-ext')">
                            üìö I need more help with this concept
                        </button>

                        <div class="extended-lesson" id="features-ext">
                            <h4>Extended Lesson: Types of Discontinuities</h4>
                            <p style="margin: 15px 0;">There are three main types of discontinuities you'll encounter:</p>

                            <div style="margin: 20px 0; padding: 15px; background: var(--bg-primary); border-radius: var(--radius-sm);">
                                <strong style="color: var(--accent-success);">1. Removable (Hole)</strong>
                                <p style="margin-top: 8px;">The limit EXISTS but doesn't equal f(a). Can be "fixed" by redefining f(a).</p>
                                <p style="font-style: italic; color: var(--text-secondary);">Example: \(\frac{x^2-4}{x-2}\) at x = 2</p>
                            </div>

                            <div style="margin: 20px 0; padding: 15px; background: var(--bg-primary); border-radius: var(--radius-sm);">
                                <strong style="color: var(--accent-warning);">2. Jump</strong>
                                <p style="margin-top: 8px;">Left and right limits both exist but aren't equal. Two-sided limit DNE.</p>
                                <p style="font-style: italic; color: var(--text-secondary);">Example: Piecewise functions at boundary points</p>
                            </div>

                            <div style="margin: 20px 0; padding: 15px; background: var(--bg-primary); border-radius: var(--radius-sm);">
                                <strong style="color: var(--accent-danger);">3. Infinite (Asymptote)</strong>
                                <p style="margin-top: 8px;">Function goes to ¬±‚àû. The limit may be written as ‚àû or DNE.</p>
                                <p style="font-style: italic; color: var(--text-secondary);">Example: \(\frac{1}{x}\) at x = 0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ==================== CORE CONCEPTS ==================== -->
        <div id="concepts" class="content-panel">
            <section class="section">
                <h2 class="section-title"><span class="icon">üí°</span> Core Concepts</h2>

                <!-- 1.1 Instantaneous Change -->
                <div class="problem-type">
                    <div class="problem-type-header">
                        <span class="problem-type-title">1.1 Can Change Occur at an Instant?</span>
                        <span class="difficulty-badge easy">Conceptual</span>
                    </div>

                    <p>This is THE question that led to calculus. Your speedometer shows instantaneous speed‚Äîbut how can you be "moving" at a single instant when motion requires time?</p>

                    <div class="step-display">
                        <strong>The Answer: Limits!</strong>
                        <div class="step-content">
                            <p>We measure average rates over shrinking intervals and find what they approach:</p>
                            <div class="math-display">\(\text{Instantaneous Rate} = \displaystyle\lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\)</div>
                        </div>
                        <div class="step-reasoning">
                            <div class="step-reasoning-title">Why This Matters</div>
                            This limit IS the derivative‚Äîthe central concept of differential calculus. Understanding limits is essential for everything that follows.
                        </div>
                    </div>
                </div>

                <!-- 1.2 Limit Notation -->
                <div class="problem-type">
                    <div class="problem-type-header">
                        <span class="problem-type-title">1.2 Defining Limits and Using Limit Notation</span>
                        <span class="difficulty-badge easy">Essential</span>
                    </div>

                    <div class="definition-box">
                        <div class="definition-title">üìñ Definition of a Limit</div>
                        <div class="math-display">\(\displaystyle\lim_{x \to a} f(x) = L\)</div>
                        <p>Means: "As x gets closer and closer to a (but ‚â† a), f(x) gets closer and closer to L."</p>
                    </div>

                    <table class="limit-table">
                        <tr>
                            <th>Notation</th>
                            <th>Meaning</th>
                        </tr>
                        <tr>
                            <td>\(\lim_{x \to 3} f(x)\)</td>
                            <td>Two-sided limit (from both sides)</td>
                        </tr>
                        <tr>
                            <td>\(\lim_{x \to 3^-} f(x)\)</td>
                            <td>Left-hand limit (from values < 3)</td>
                        </tr>
                        <tr>
                            <td>\(\lim_{x \to 3^+} f(x)\)</td>
                            <td>Right-hand limit (from values > 3)</td>
                        </tr>
                    </table>

                    <div class="exam-tip">
                        <div class="exam-tip-label">üéØ AP Exam Tip #1</div>
                        The two-sided limit exists if and only if BOTH one-sided limits exist AND are equal:<br>
                        \(\lim_{x \to a^-} f(x) = \lim_{x \to a^+} f(x) = L \implies \lim_{x \to a} f(x) = L\)
                    </div>
                </div>

                <!-- 1.3 & 1.4 Estimation -->
                <div class="problem-type">
                    <div class="problem-type-header">
                        <span class="problem-type-title">1.3‚Äì1.4 Estimating Limits from Graphs and Tables</span>
                        <span class="difficulty-badge medium">üî• High Frequency (19 MCQ)</span>
                    </div>

                    <div class="pattern-box">
                        <div class="pattern-title">üîç Three-Step Process</div>
                        <ol style="padding-left: 20px; margin-top: 10px;">
                            <li><strong>Identify</strong> the target x-value</li>
                            <li><strong>Track</strong> from both left and right</li>
                            <li><strong>Compare</strong>: If both sides match ‚Üí that's the limit. If not ‚Üí DNE</li>
                        </ol>
                    </div>

                    <div class="exam-tip">
                        <div class="exam-tip-label">üéØ AP Exam Tip #2</div>
                        The actual value f(a) is <strong>irrelevant</strong> for finding the limit. A hole doesn't affect the limit‚Äîonly where the curve is heading matters!
                    </div>
                </div>
            </section>
        </div>

        <!-- ==================== PROBLEM TYPES ==================== -->
        <div id="problems" class="content-panel">
            <section class="section">
                <h2 class="section-title"><span class="icon">üìù</span> Problem Types</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Master these four problem types that appear on the AP exam.</p>

                <!-- METHOD SELECTION FRAMEWORK -->
                <div class="method-framework">
                    <div class="method-framework-title">üß≠ Method Selection Framework</div>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Before solving, identify which approach to use based on the question format.</p>

                    <div class="when-to-use">
                        <h4 style="margin-bottom: 12px;">When to Check BOTH Sides (Two-Sided Limit)</h4>
                        <div class="use-case">
                            <span class="use-case-icon do">‚úì</span>
                            <span class="use-case-text">Question asks for \(\lim_{x \to a} f(x)\) with <strong>no superscript</strong> on the a</span>
                        </div>
                        <div class="use-case">
                            <span class="use-case-icon do">‚úì</span>
                            <span class="use-case-text">Piecewise function at a boundary point</span>
                        </div>
                        <div class="use-case">
                            <span class="use-case-icon dont">‚úó</span>
                            <span class="use-case-text">Don't use when question explicitly asks for \(\lim_{x \to a^+}\) or \(\lim_{x \to a^-}\)</span>
                        </div>
                    </div>

                    <div class="when-to-use">
                        <h4 style="margin-bottom: 12px;">When to Check ONE Side Only (One-Sided Limit)</h4>
                        <div class="use-case">
                            <span class="use-case-icon do">‚úì</span>
                            <span class="use-case-text">Question asks for \(\lim_{x \to a^+} f(x)\) ‚Äî check from the RIGHT only (x > a)</span>
                        </div>
                        <div class="use-case">
                            <span class="use-case-icon do">‚úì</span>
                            <span class="use-case-text">Question asks for \(\lim_{x \to a^-} f(x)\) ‚Äî check from the LEFT only (x < a)</span>
                        </div>
                        <div class="use-case">
                            <span class="use-case-icon dont">‚úó</span>
                            <span class="use-case-text">Don't check both sides‚Äîwastes time and may confuse your answer</span>
                        </div>
                    </div>

                    <div class="decision-flowchart">
                        <div class="flowchart-title">Decision Flowchart: What Type of Limit?</div>
                        <div class="flowchart-container">
                            <div class="flowchart-node question">Does the limit notation have a + or - superscript?</div>
                            <div class="flowchart-arrow">‚Üì</div>
                            <div class="flowchart-branch">
                                <div class="flowchart-branch-item">
                                    <div class="flowchart-branch-label yes">YES (+/-)</div>
                                    <div class="flowchart-node answer">One-sided limit<br>Check only that side</div>
                                </div>
                                <div class="flowchart-branch-item">
                                    <div class="flowchart-branch-label no">NO</div>
                                    <div class="flowchart-node answer">Two-sided limit<br>Check BOTH sides</div>
                                </div>
                            </div>
                            <div class="flowchart-arrow" style="margin-top: 15px;">‚Üì</div>
                            <div class="flowchart-node question" style="background: rgba(245, 158, 11, 0.15); border-color: var(--accent-warning);">
                                For two-sided: Do left and right limits match?
                            </div>
                            <div class="flowchart-arrow">‚Üì</div>
                            <div class="flowchart-branch">
                                <div class="flowchart-branch-item">
                                    <div class="flowchart-branch-label yes">MATCH</div>
                                    <div class="flowchart-node answer">Limit = that value</div>
                                </div>
                                <div class="flowchart-branch-item">
                                    <div class="flowchart-branch-label no">DON'T MATCH</div>
                                    <div class="flowchart-node answer" style="border-color: var(--accent-danger); color: var(--accent-danger);">Limit DNE</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TYPE 1: Graph-Based Two-Sided -->
                <div class="problem-type" id="problem-type-1">
                    <div class="problem-type-header">
                        <span class="problem-type-title">Type 1: Two-Sided Limit from Graph</span>
                        <span class="difficulty-badge easy">Basic</span>
                        <span class="freq-badge standard">üìö Standard</span>
                    </div>

                    <div class="pattern-box">
                        <div class="pattern-title">üîç Recognition Pattern</div>
                        <div class="pattern-do">
                            <span class="pattern-icon">‚úì</span>
                            <span>Use when: Question asks for \(\lim_{x \to a} f(x)\) with a graph, <strong>no + or - superscript</strong></span>
                        </div>
                        <div class="pattern-do">
                            <span class="pattern-icon">‚úì</span>
                            <span>Strategy: Check BOTH sides ‚Äî they must agree for the limit to exist</span>
                        </div>
                        <div class="pattern-dont">
                            <span class="pattern-icon">‚úó</span>
                            <span>Don't use when: Question asks for one-sided limit (\(x \to a^+\) or \(x \to a^-\))</span>
                        </div>
                    </div>

                    <h4 style="margin: 20px 0 10px;">Worked Example</h4>
                    <div class="graph-container">
                        <div id="type1-graph" class="graph-plot"></div>
                    </div>
                    <p>Find \(\displaystyle\lim_{x \to 2} f(x)\)</p>

                    <!-- Animation Controls -->
                    <div class="animation-controls">
                        <button class="control-btn" onclick="animPrev('type1')" id="type1-prev" disabled>
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                        </button>
                        <button class="control-btn" onclick="animToggle('type1')" id="type1-play">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                        </button>
                        <button class="control-btn" onclick="animNextWithPrediction('type1')" id="type1-next">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                        </button>
                        <button class="control-btn" onclick="animReset('type1')">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                        </button>
                        <span class="step-counter" id="type1-counter">Step 0/3</span>
                        <div class="progress-bar"><div class="progress-fill" id="type1-progress" style="width: 0%"></div></div>
                        <div class="speed-control">
                            <button class="speed-btn" onclick="setAnimSpeed('type1', 0.5)">0.5x</button>
                            <button class="speed-btn active" onclick="setAnimSpeed('type1', 1)">1x</button>
                            <button class="speed-btn" onclick="setAnimSpeed('type1', 2)">2x</button>
                        </div>
                    </div>

                    <div class="step-display" id="type1-steps">
                        <p style="color: var(--text-secondary); font-style: italic;">Click Play or Next to see the step-by-step solution.</p>
                    </div>

                    <div class="exam-tip">
                        <div class="exam-tip-label">üéØ AP Exam Tip #3</div>
                        Even with a hole at (2, 3) and a dot at (2, 5), if both sides approach 3, then \(\lim_{x \to 2} f(x) = 3\). The hole doesn't affect the limit!
                    </div>
                </div>

                <!-- TYPE 2: One-Sided Limits -->
                <div class="problem-type" id="problem-type-2">
                    <div class="problem-type-header">
                        <span class="problem-type-title">Type 2: One-Sided Limits</span>
                        <span class="difficulty-badge easy">Basic</span>
                        <span class="freq-badge standard">üìö Standard</span>
                    </div>

                    <div class="pattern-box">
                        <div class="pattern-title">üîç Recognition Pattern</div>
                        <div class="pattern-do">
                            <span class="pattern-icon">‚úì</span>
                            <span>Use when: Question has \(\lim_{x \to a^-} f(x)\) or \(\lim_{x \to a^+} f(x)\) with superscript</span>
                        </div>
                        <div class="pattern-do">
                            <span class="pattern-icon">‚úì</span>
                            <span>Strategy: Only check ONE side (+ = right/values > a, - = left/values < a)</span>
                        </div>
                        <div class="pattern-dont">
                            <span class="pattern-icon">‚úó</span>
                            <span>Don't use when: No superscript ‚Äî that's a two-sided limit, check both!</span>
                        </div>
                    </div>

                    <h4 style="margin: 20px 0 10px;">Worked Example</h4>
                    <div class="graph-container">
                        <div id="type2-graph" class="graph-plot"></div>
                    </div>
                    <p>Find: a) \(\lim_{x \to 1^-} f(x)\) &nbsp; b) \(\lim_{x \to 1^+} f(x)\) &nbsp; c) \(\lim_{x \to 1} f(x)\)</p>

                    <div class="animation-controls">
                        <button class="control-btn" onclick="animPrev('type2')" id="type2-prev" disabled>
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                        </button>
                        <button class="control-btn" onclick="animToggle('type2')" id="type2-play">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                        </button>
                        <button class="control-btn" onclick="animNextWithPrediction('type2')" id="type2-next">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                        </button>
                        <button class="control-btn" onclick="animReset('type2')">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                        </button>
                        <span class="step-counter" id="type2-counter">Step 0/4</span>
                        <div class="progress-bar"><div class="progress-fill" id="type2-progress" style="width: 0%"></div></div>
                    </div>

                    <div class="step-display" id="type2-steps">
                        <p style="color: var(--text-secondary); font-style: italic;">Click Play or Next to see the step-by-step solution.</p>
                    </div>

                    <div class="exam-tip">
                        <div class="exam-tip-label">üéØ AP Exam Tip #4</div>
                        When left limit ‚â† right limit, the two-sided limit <strong>does not exist (DNE)</strong>. Always check both sides before concluding a two-sided limit exists.
                    </div>
                </div>

                <!-- TYPE 3: Piecewise Functions -->
                <div class="problem-type" id="problem-type-3">
                    <div class="problem-type-header">
                        <span class="problem-type-title">Type 3: Piecewise Function Limits</span>
                        <span class="difficulty-badge medium">Intermediate</span>
                        <span class="freq-badge standard">üìö Standard</span>
                    </div>

                    <div class="pattern-box">
                        <div class="pattern-title">üîç Recognition Pattern</div>
                        <div class="pattern-do">
                            <span class="pattern-icon">‚úì</span>
                            <span>Use when: Function defined with cases/braces for different intervals</span>
                        </div>
                        <div class="pattern-do">
                            <span class="pattern-icon">‚úì</span>
                            <span>Strategy: Use \(x < a\) formula for left, \(x > a\) formula for right</span>
                        </div>
                        <div class="pattern-dont">
                            <span class="pattern-icon">‚úó</span>
                            <span>Don't use: The \(x = a\) piece for limits ‚Äî that only gives f(a), not the limit!</span>
                        </div>
                    </div>

                    <h4 style="margin: 20px 0 10px;">Worked Example</h4>
                    <div class="math-display">
                        \(f(x) = \begin{cases} x^2 & \text{if } x < 2 \\ 5 & \text{if } x = 2 \\ 3x - 2 & \text{if } x > 2 \end{cases}\)
                    </div>
                    <p>Find \(\displaystyle\lim_{x \to 2} f(x)\)</p>

                    <div class="animation-controls">
                        <button class="control-btn" onclick="animPrev('type3')" id="type3-prev" disabled>
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                        </button>
                        <button class="control-btn" onclick="animToggle('type3')" id="type3-play">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                        </button>
                        <button class="control-btn" onclick="animNextWithPrediction('type3')" id="type3-next">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                        </button>
                        <button class="control-btn" onclick="animReset('type3')">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                        </button>
                        <span class="step-counter" id="type3-counter">Step 0/4</span>
                        <div class="progress-bar"><div class="progress-fill" id="type3-progress" style="width: 0%"></div></div>
                    </div>

                    <div class="step-display" id="type3-steps">
                        <p style="color: var(--text-secondary); font-style: italic;">Click Play or Next to see the step-by-step solution.</p>
                    </div>

                    <div class="exam-tip">
                        <div class="exam-tip-label">üéØ AP Exam Tip #5</div>
                        For piecewise limits: Left side uses the "x < a" formula, Right side uses the "x > a" formula. The "x = a" piece (if any) is irrelevant for the limit!
                    </div>
                </div>

                <!-- TYPE 4: Table-Based -->
                <div class="problem-type" id="problem-type-4">
                    <div class="problem-type-header">
                        <span class="problem-type-title">Type 4: Table-Based Limit Estimation</span>
                        <span class="difficulty-badge easy">Basic</span>
                        <span class="freq-badge high-priority">üî• High Priority</span>
                    </div>

                    <div class="pattern-box">
                        <div class="pattern-title">üîç Recognition Pattern</div>
                        <div class="pattern-do">
                            <span class="pattern-icon">‚úì</span>
                            <span>Use when: Given a table of (x, f(x)) values approaching target from both sides</span>
                        </div>
                        <div class="pattern-do">
                            <span class="pattern-icon">‚úì</span>
                            <span>Strategy: Look at the pattern ‚Äî what value are the y-values approaching?</span>
                        </div>
                        <div class="pattern-dont">
                            <span class="pattern-icon">‚úó</span>
                            <span>Don't: Confuse the x-values with the limit ‚Äî you want where f(x) is heading!</span>
                        </div>
                    </div>

                    <h4 style="margin: 20px 0 10px;">Worked Example</h4>
                    <p>Estimate \(\displaystyle\lim_{x \to 0} \frac{\sin x}{x}\)</p>

                    <table class="limit-table">
                        <tr>
                            <th>x</th>
                            <th>-0.1</th>
                            <th>-0.01</th>
                            <th>-0.001</th>
                            <th style="background: var(--accent-secondary);">‚Üí 0 ‚Üê</th>
                            <th>0.001</th>
                            <th>0.01</th>
                            <th>0.1</th>
                        </tr>
                        <tr>
                            <td><strong>f(x)</strong></td>
                            <td>0.9983</td>
                            <td>0.99998</td>
                            <td>0.9999998</td>
                            <td class="highlight-cell">?</td>
                            <td>0.9999998</td>
                            <td>0.99998</td>
                            <td>0.9983</td>
                        </tr>
                    </table>

                    <div class="step-display">
                        <span class="step-number">‚úì</span><strong>Solution</strong>
                        <div class="step-content">
                            From both sides, f(x) ‚Üí <strong>1</strong>. Therefore: \(\displaystyle\lim_{x \to 0} \frac{\sin x}{x} = 1\)
                        </div>
                        <div class="step-reasoning">
                            <div class="step-reasoning-title">Why This Works</div>
                            As x gets closer to 0, the outputs consistently approach 1 from both sides. This convergence is what the limit captures.
                        </div>
                    </div>

                    <div class="exam-tip">
                        <div class="exam-tip-label">üéØ AP Exam Tip #6</div>
                        MEMORIZE: \(\lim_{x \to 0} \frac{\sin x}{x} = 1\). This fundamental limit appears frequently and is key for finding the derivative of sin(x).
                    </div>
                </div>

                <!-- TYPE 5: Limits Involving Infinity -->
                <div class="problem-type" id="problem-type-5">
                    <div class="problem-type-header">
                        <span class="problem-type-title">Type 5: Limits Involving Infinity</span>
                        <span class="difficulty-badge medium">Intermediate</span>
                        <span class="freq-badge high-priority">üî• High Priority</span>
                    </div>

                    <div class="pattern-box">
                        <div class="pattern-title">üîç Recognition Pattern</div>
                        <div class="pattern-do">
                            <span class="pattern-icon">‚úì</span>
                            <span>Use when: Function has a vertical asymptote (denominator ‚Üí 0) or grows without bound</span>
                        </div>
                        <div class="pattern-do">
                            <span class="pattern-icon">‚úì</span>
                            <span>Strategy: Check sign from each side ‚Äî does it go to +‚àû or -‚àû?</span>
                        </div>
                        <div class="pattern-dont">
                            <span class="pattern-icon">‚úó</span>
                            <span>Don't: Write "‚àû" as the limit ‚Äî the limit DNE when sides disagree (one is +‚àû, other is -‚àû)</span>
                        </div>
                    </div>

                    <h4 style="margin: 20px 0 10px;">Worked Example</h4>
                    <p>Find \(\displaystyle\lim_{x \to 0} \frac{1}{x^2}\) and \(\displaystyle\lim_{x \to 0} \frac{1}{x}\)</p>

                    <div class="graph-container">
                        <div id="type5-graph" class="graph-plot"></div>
                    </div>

                    <div class="animation-controls">
                        <button id="type5-prev" onclick="animPrev('type5')" disabled>‚óÄ</button>
                        <button id="type5-play" onclick="animToggle('type5')"><svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M8 5v14l11-7z"/></svg></button>
                        <button id="type5-next" onclick="animNext('type5')">‚ñ∂</button>
                        <button onclick="animReset('type5')">‚Ü∫</button>
                        <div class="speed-controls">
                            <button class="speed-btn" onclick="setAnimSpeed('type5', 0.5)">0.5x</button>
                            <button class="speed-btn active" onclick="setAnimSpeed('type5', 1)">1x</button>
                            <button class="speed-btn" onclick="setAnimSpeed('type5', 2)">2x</button>
                        </div>
                    </div>

                    <div class="animation-progress">
                        <span class="step-counter" id="type5-counter">Step 0/4</span>
                        <div class="progress-bar"><div class="progress-fill" id="type5-progress" style="width: 0%"></div></div>
                    </div>

                    <div class="step-display" id="type5-steps">
                        <p style="color: var(--text-secondary); font-style: italic;">Click Play or Next to see the step-by-step solution.</p>
                    </div>

                    <div class="exam-tip">
                        <div class="exam-tip-label">üéØ AP Exam Tip #7</div>
                        For vertical asymptotes: If BOTH sides go to +‚àû, write \(\lim = +\infty\). If BOTH sides go to -‚àû, write \(\lim = -\infty\). If sides DISAGREE (one +‚àû, one -‚àû), the limit <strong>DNE</strong>. This is a common FRQ trap!
                    </div>
                </div>
            </section>
        </div>

        <!-- ==================== PRACTICE ==================== -->
        <div id="practice" class="content-panel">
            <section class="section">
                <h2 class="section-title"><span class="icon">‚úèÔ∏è</span> Practice Problems</h2>
                <p style="color: var(--text-secondary); margin-bottom: 10px;">Complete Level 1 to unlock Level 2. Track your progress!</p>

                <!-- LEVEL 1 -->
                <div class="level-section" id="level-1-section">
                    <div class="level-header">
                        <span class="level-badge level-1">LEVEL 1: BASIC</span>
                        <span style="color: var(--text-secondary);">Direct Application (Complete 4/4 to unlock Level 2)</span>
                    </div>

                    <!-- Type 1: Two-Sided Graph -->
                    <div class="practice-type-header">
                        <span class="type-num">Type 1</span>
                        Two-Sided Limit from Graph
                    </div>

                    <div class="practice-problem">
                        <div class="practice-problem-header">
                            <span class="practice-number">Problem 1</span>
                            <span class="difficulty-badge easy">Graph Two-Sided</span>
                        </div>
                        <div class="graph-container"><div id="practice-graph-1" class="graph-plot"></div></div>
                        <p>What is \(\displaystyle\lim_{x \to 1} f(x)\)?</p>
                        <div class="prediction-box" id="pred-p1">
                            <div class="prediction-options">
                                <div class="prediction-option" onclick="selectPred(this, 'p1')">2</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p1')">3</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p1')">4</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p1')">DNE</div>
                            </div>
                            <button class="prediction-submit" onclick="checkPred('p1', '3')">Submit</button>
                            <div class="prediction-feedback" id="feedback-p1"></div>
                        </div>
                    </div>

                    <!-- Type 2: One-Sided -->
                    <div class="practice-type-header">
                        <span class="type-num">Type 2</span>
                        One-Sided Limits
                    </div>

                    <div class="practice-problem">
                        <div class="practice-problem-header">
                            <span class="practice-number">Problem 2</span>
                            <span class="difficulty-badge easy">One-Sided</span>
                        </div>
                        <div class="graph-container"><div id="practice-graph-3" class="graph-plot"></div></div>
                        <p>What is \(\displaystyle\lim_{x \to 2^+} f(x)\)?</p>
                        <div class="prediction-box" id="pred-p3">
                            <div class="prediction-options">
                                <div class="prediction-option" onclick="selectPred(this, 'p3')">1</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p3')">3</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p3')">4</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p3')">DNE</div>
                            </div>
                            <button class="prediction-submit" onclick="checkPred('p3', '4')">Submit</button>
                            <div class="prediction-feedback" id="feedback-p3"></div>
                        </div>
                    </div>

                    <!-- Type 3: Piecewise -->
                    <div class="practice-type-header">
                        <span class="type-num">Type 3</span>
                        Piecewise Function Limits
                    </div>

                    <div class="practice-problem">
                        <div class="practice-problem-header">
                            <span class="practice-number">Problem 3</span>
                            <span class="difficulty-badge easy">Piecewise</span>
                        </div>
                        <p>Let \(g(x) = \begin{cases} 2x + 1 & x < 3 \\ 10 & x = 3 \\ x^2 - 2 & x > 3 \end{cases}\)</p>
                        <p>Find \(\displaystyle\lim_{x \to 3} g(x)\)</p>
                        <div class="prediction-box" id="pred-p4">
                            <div class="prediction-options">
                                <div class="prediction-option" onclick="selectPred(this, 'p4')">7</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p4')">10</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p4')">DNE</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p4')">9</div>
                            </div>
                            <button class="prediction-submit" onclick="checkPred('p4', '7')">Submit</button>
                            <div class="prediction-feedback" id="feedback-p4"></div>
                        </div>
                    </div>

                    <!-- Type 4: Table-Based -->
                    <div class="practice-type-header">
                        <span class="type-num">Type 4</span>
                        Table-Based Estimation üî•
                    </div>

                    <div class="practice-problem">
                        <div class="practice-problem-header">
                            <span class="practice-number">Problem 4</span>
                            <span class="difficulty-badge easy">Table</span>
                        </div>
                        <p>Use the table to estimate \(\displaystyle\lim_{x \to 2} (x^2 - 1)\)</p>
                        <table class="limit-table">
                            <tr><th>x</th><th>1.9</th><th>1.99</th><th>1.999</th><th>2.001</th><th>2.01</th><th>2.1</th></tr>
                            <tr><td>f(x)</td><td>2.61</td><td>2.9601</td><td>2.996</td><td>3.004</td><td>3.0401</td><td>3.41</td></tr>
                        </table>
                        <div class="prediction-box" id="pred-p2">
                            <div class="prediction-options">
                                <div class="prediction-option" onclick="selectPred(this, 'p2')">2</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p2')">3</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p2')">4</div>
                                <div class="prediction-option" onclick="selectPred(this, 'p2')">DNE</div>
                            </div>
                            <button class="prediction-submit" onclick="checkPred('p2', '3')">Submit</button>
                            <div class="prediction-feedback" id="feedback-p2"></div>
                        </div>
                    </div>
                </div>

                <!-- LEVEL 2 -->
                <div class="level-section" id="level-2-section">
                    <div class="level-header">
                        <span class="level-badge level-2" id="level2-badge">LEVEL 2: INTERMEDIATE üîí</span>
                        <span style="color: var(--text-secondary);">Multi-step (Complete Level 1 first)</span>
                    </div>
                    <div class="level-locked-msg" id="level2-locked">
                        Complete all Level 1 problems correctly to unlock Level 2.
                    </div>
                    <div id="level2-content" style="display: none;">
                        <div class="practice-problem">
                            <div class="practice-problem-header">
                                <span class="practice-number">Problem 5</span>
                                <span class="difficulty-badge medium">Multi-part</span>
                            </div>
                            <div class="graph-container"><div id="practice-graph-5" class="graph-plot"></div></div>
                            <p>Using the graph, find all values:</p>
                            <p style="margin: 10px 0;">\(\lim_{x \to 0^-} f(x) = \) <input type="text" class="answer-input" id="ans-5a" style="width: 60px; display: inline;"></p>
                            <p style="margin: 10px 0;">\(\lim_{x \to 0^+} f(x) = \) <input type="text" class="answer-input" id="ans-5b" style="width: 60px; display: inline;"></p>
                            <p style="margin: 10px 0;">\(\lim_{x \to 0} f(x) = \) <input type="text" class="answer-input" id="ans-5c" style="width: 60px; display: inline;"></p>
                            <p style="margin: 10px 0;">\(f(0) = \) <input type="text" class="answer-input" id="ans-5d" style="width: 60px; display: inline;"></p>
                            <button class="check-answer-btn" onclick="checkMulti5()">Check All</button>
                            <button class="show-solution-btn" onclick="toggleSol('sol-5')">Show Solution</button>
                            <div class="solution-display" id="sol-5">
                                <p><strong>Answers:</strong> a) 2, b) -1, c) DNE (2 ‚â† -1), d) 3</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LEVEL 3 -->
                <div class="level-section" id="level-3-section">
                    <div class="level-header">
                        <span class="level-badge level-3" id="level3-badge">LEVEL 3: AP EXAM STYLE üîí</span>
                        <span style="color: var(--text-secondary);">Full AP-style MCQ</span>
                    </div>
                    <div class="level-locked-msg" id="level3-locked">
                        Complete Level 2 to unlock Level 3.
                    </div>
                    <div id="level3-content" style="display: none;">
                        <div class="practice-problem">
                            <div class="practice-problem-header">
                                <span class="practice-number">Problem 6 (AP Style)</span>
                                <span class="difficulty-badge hard">MCQ</span>
                            </div>
                            <p>Let f be defined as \(f(x) = \begin{cases} \frac{x^2 - 4}{x - 2} & x \neq 2 \\ k & x = 2 \end{cases}\)</p>
                            <p>For what value of k is f continuous at x = 2?</p>
                            <div style="margin: 15px 0;">
                                <label style="display: block; padding: 10px; background: var(--bg-tertiary); border-radius: var(--radius-sm); margin: 5px 0; cursor: pointer;">
                                    <input type="radio" name="q6" value="A"> (A) 0
                                </label>
                                <label style="display: block; padding: 10px; background: var(--bg-tertiary); border-radius: var(--radius-sm); margin: 5px 0; cursor: pointer;">
                                    <input type="radio" name="q6" value="B"> (B) 2
                                </label>
                                <label style="display: block; padding: 10px; background: var(--bg-tertiary); border-radius: var(--radius-sm); margin: 5px 0; cursor: pointer;">
                                    <input type="radio" name="q6" value="C"> (C) 4
                                </label>
                                <label style="display: block; padding: 10px; background: var(--bg-tertiary); border-radius: var(--radius-sm); margin: 5px 0; cursor: pointer;">
                                    <input type="radio" name="q6" value="D"> (D) No such k exists
                                </label>
                            </div>
                            <button class="check-answer-btn" onclick="checkQ6()">Check Answer</button>
                            <button class="show-solution-btn" onclick="toggleSol('sol-6')">Show Solution</button>
                            <div class="solution-display" id="sol-6">
                                <p><strong>Answer: (C) 4</strong></p>
                                <p>Factor: \(\frac{x^2-4}{x-2} = \frac{(x-2)(x+2)}{x-2} = x + 2\) for x ‚â† 2</p>
                                <p>So \(\lim_{x \to 2} f(x) = 2 + 2 = 4\)</p>
                                <p>For continuity, need f(2) = k = limit = 4</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ==================== EXAM TIPS SUMMARY ==================== -->
        <div id="tips" class="content-panel">
            <section class="section">
                <h2 class="section-title"><span class="icon">üí°</span> Exam Tips Summary</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">All the key tips collected in one place for quick review.</p>

                <div class="tips-summary">
                    <h3>üéØ Must-Know Tips for U1.1</h3>
                    <ul>
                        <li><strong>Tip #1:</strong> Two-sided limit exists ‚ü∫ Left limit = Right limit. Always check both sides!</li>
                        <li><strong>Tip #2:</strong> f(a) is irrelevant for limits. Holes don't affect where the curve is heading.</li>
                        <li><strong>Tip #3:</strong> A hole at (a, L) means the limit IS L, even though f(a) ‚â† L or is undefined.</li>
                        <li><strong>Tip #4:</strong> Left ‚â† Right ‚üπ DNE. The two-sided limit cannot exist if the one-sided limits differ.</li>
                        <li><strong>Tip #5:</strong> Piecewise: Use x < a formula for left, x > a formula for right. Ignore the x = a piece for limits.</li>
                        <li><strong>Tip #6:</strong> MEMORIZE: \(\lim_{x \to 0} \frac{\sin x}{x} = 1\) ‚Äî appears constantly!</li>
                    </ul>
                </div>

                <div class="definition-box">
                    <div class="definition-title">üìã Quick Reference: When Does Limit DNE?</div>
                    <table class="limit-table" style="margin-top: 15px;">
                        <tr><th>Scenario</th><th>Result</th></tr>
                        <tr><td>Left limit ‚â† Right limit (jump)</td><td><strong>DNE</strong></td></tr>
                        <tr><td>Function ‚Üí +‚àû from both sides</td><td>+‚àû (or DNE)</td></tr>
                        <tr><td>Function ‚Üí -‚àû from both sides</td><td>-‚àû (or DNE)</td></tr>
                        <tr><td>Left ‚Üí +‚àû, Right ‚Üí -‚àû (or vice versa)</td><td><strong>DNE</strong></td></tr>
                        <tr><td>Oscillation (like sin(1/x) at 0)</td><td><strong>DNE</strong></td></tr>
                        <tr><td>Both sides approach same L</td><td><strong>L exists!</strong></td></tr>
                    </table>
                </div>
            </section>
        </div>

        <!-- ==================== COMMON MISTAKES ==================== -->
        <div id="mistakes" class="content-panel">
            <section class="section">
                <h2 class="section-title"><span class="icon">‚ö†Ô∏è</span> Common Mistakes</h2>

                <div class="mistake-card">
                    <h4>Mistake #1: Confusing limit with function value</h4>
                    <p class="mistake-wrong">"f(2) = 5, so the limit as x‚Üí2 is 5"</p>
                    <p class="mistake-correct">‚úì The limit depends on where f(x) is HEADING, not what f(2) equals.</p>
                    <p class="mistake-why">Why it happens: Natural to think "limit at 2" = "value at 2". But limits are about approaching behavior.</p>
                </div>

                <div class="mistake-card">
                    <h4>Mistake #2: Only checking one side</h4>
                    <p class="mistake-wrong">"From the left it goes to 3, so the limit is 3"</p>
                    <p class="mistake-correct">‚úì Must check BOTH sides. If they disagree, the two-sided limit DNE.</p>
                    <p class="mistake-why">Why it happens: Easy to stop early. Train yourself to always verify both directions.</p>
                </div>

                <div class="mistake-card">
                    <h4>Mistake #3: Thinking holes break limits</h4>
                    <p class="mistake-wrong">"There's a hole at x=2 so the limit DNE"</p>
                    <p class="mistake-correct">‚úì Holes don't affect limits. If the curve heads to L from both sides, limit = L.</p>
                    <p class="mistake-why">Why it happens: Holes mean f(a) is undefined, but limits don't care about the actual value at a.</p>
                </div>

                <div class="mistake-card">
                    <h4>Mistake #4: Misreading one-sided notation</h4>
                    <p class="mistake-wrong">"x ‚Üí 2‚Å∫ means x is positive"</p>
                    <p class="mistake-correct">‚úì The + means from the RIGHT (x > 2). The - means from the LEFT (x < 2).</p>
                    <p class="mistake-why">Why it happens: The + symbol is misleading. Remember: + = right side, - = left side.</p>
                </div>

                <div class="mistake-card">
                    <h4>Mistake #5: Using wrong piece for piecewise limit</h4>
                    <p class="mistake-wrong">"At x=2, use the formula for x=2 to find the limit"</p>
                    <p class="mistake-correct">‚úì For limits, use x < 2 formula for left limit, x > 2 formula for right. Ignore x = 2 piece.</p>
                    <p class="mistake-why">Why it happens: Limits are about approaching, not arriving. The x = 2 piece only affects f(2), not the limit.</p>
                </div>
            </section>
        </div>

        <!-- ==================== CONNECTIONS ==================== -->
        <div id="connections" class="content-panel">
            <section class="section">
                <h2 class="section-title"><span class="icon">üîó</span> Forward Connections</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Limits are the foundation. Here's how they connect to future topics:</p>

                <div class="connection-card" onclick="toggleConnectionPreview('conn1')">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 50px; height: 50px; background: var(--accent-primary); border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">üìê</div>
                        <div>
                            <strong>U1.2 Calculating Limits</strong>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Algebraic techniques for when you can't read limits from graphs</p>
                        </div>
                    </div>
                    <div class="connection-preview" id="conn1" style="display: none;">
                        <p>When direct substitution gives 0/0, you'll learn techniques like:</p>
                        <ul style="padding-left: 20px; margin-top: 10px;">
                            <li>Factoring to cancel</li>
                            <li>Rationalizing (conjugates)</li>
                            <li>Trig identities</li>
                        </ul>
                    </div>
                </div>

                <div class="connection-card" onclick="toggleConnectionPreview('conn2')">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 50px; height: 50px; background: var(--accent-secondary); border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">üìä</div>
                        <div>
                            <strong>U1.4 Continuity</strong>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">A function is continuous when limit = function value</p>
                        </div>
                    </div>
                    <div class="connection-preview" id="conn2" style="display: none;">
                        <p>Continuity at x = a requires THREE conditions:</p>
                        <ol style="padding-left: 20px; margin-top: 10px;">
                            <li>f(a) exists</li>
                            <li>\(\lim_{x \to a} f(x)\) exists</li>
                            <li>\(\lim_{x \to a} f(x) = f(a)\)</li>
                        </ol>
                    </div>
                </div>

                <div class="connection-card" onclick="toggleConnectionPreview('conn3')">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 50px; height: 50px; background: var(--accent-success); border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">üìà</div>
                        <div>
                            <strong>U2.2 Definition of Derivative</strong>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">The derivative IS a limit ‚Äî instantaneous rate of change</p>
                        </div>
                    </div>
                    <div class="connection-preview" id="conn3" style="display: none;">
                        <p>The derivative is defined as:</p>
                        <div class="math-display">\(f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}\)</div>
                        <p>Without understanding limits, you cannot understand derivatives!</p>
                    </div>
                </div>
            </section>

            <section class="section">
                <h2 class="section-title"><span class="icon">‚úÖ</span> Self-Assessment</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Check off when you're confident:</p>

                <div class="assessment-item" onclick="toggleCheck(this)"><div class="assessment-checkbox"></div><span>I can estimate limits from graphs by checking both sides</span></div>
                <div class="assessment-item" onclick="toggleCheck(this)"><div class="assessment-checkbox"></div><span>I can estimate limits from tables of values</span></div>
                <div class="assessment-item" onclick="toggleCheck(this)"><div class="assessment-checkbox"></div><span>I understand one-sided vs two-sided limits</span></div>
                <div class="assessment-item" onclick="toggleCheck(this)"><div class="assessment-checkbox"></div><span>I can identify when a limit DNE and explain why</span></div>
                <div class="assessment-item" onclick="toggleCheck(this)"><div class="assessment-checkbox"></div><span>I know that f(a) and lim f(x) as x‚Üía are different</span></div>
                <div class="assessment-item" onclick="toggleCheck(this)"><div class="assessment-checkbox"></div><span>I can evaluate limits for piecewise functions</span></div>
            </section>
        </div>
    </div>

    <script>
        // ========== THEME ==========
        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
            document.querySelector('.sun-icon').style.display = isDark ? 'none' : 'block';
            document.querySelector('.moon-icon').style.display = isDark ? 'block' : 'none';
            setTimeout(initGraphs, 100);
        }

        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);
        if (savedTheme === 'dark') {
            document.querySelector('.sun-icon').style.display = 'block';
            document.querySelector('.moon-icon').style.display = 'none';
        }

        // ========== NAVIGATION ==========
        function showPanel(id) {
            document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
            setTimeout(initGraphs, 100);
        }

        // ========== PREREQUISITES ==========
        function togglePrereq(id) {
            document.getElementById(`prereq-${id}-lesson`).classList.toggle('expanded');
            setTimeout(initGraphs, 100);
        }

        // ========== ANIMATIONS ==========
        const animations = {
            type1: {
                step: 0,
                playing: false,
                interval: null,
                speed: 1,
                steps: [
                    {
                        title: "Identify the target",
                        content: "We want \\(\\lim_{x \\to 2} f(x)\\). Locate x = 2 on the graph.",
                        why: "<strong>Why start here?</strong> The notation \\(\\lim_{x \\to 2}\\) tells us WHERE to focus. No superscript means we need to check BOTH sides (from the Method Selection Framework). Skipping this step leads to checking the wrong location!"
                    },
                    {
                        title: "Track from the LEFT",
                        content: "As x approaches 2 from values less than 2, the curve approaches y = 3.",
                        why: "<strong>Why the left first?</strong> For a two-sided limit, we must verify both sides match. We start left (x < 2) because the Method Selection Framework requires checking both. Following the curve from x = 1.5, 1.8, 1.9, 1.99... we see y ‚Üí 3."
                    },
                    {
                        title: "Track from the RIGHT",
                        content: "As x approaches 2 from values greater than 2, the curve also approaches y = 3.",
                        why: "<strong>Why check right too?</strong> If we stopped after just the left side, we'd miss cases where the limit DNE! Following from x = 2.5, 2.2, 2.1, 2.01... we see y ‚Üí 3 also. Now we can compare."
                    },
                    {
                        title: "Conclusion",
                        content: "Both sides agree! Therefore \\(\\lim_{x \\to 2} f(x) = 3\\). (The hole and dot are irrelevant!)",
                        why: "<strong>Why does the limit exist?</strong> Left = Right = 3. The hole at (2,3) and dot at (2,5) don't matter because limits are about WHERE the function HEADS, not WHERE it actually IS. Common mistake: thinking holes break limits!"
                    }
                ]
            },
            type2: {
                step: 0,
                playing: false,
                interval: null,
                speed: 1,
                steps: [
                    {
                        title: "Identify: Jump at x = 1",
                        content: "The graph shows different behaviors on each side of x = 1.",
                        why: "<strong>Why notice the jump?</strong> A visual discontinuity signals we need to be careful. For one-sided limits (+ or - superscript), we only check the indicated side. But here we're asked for both sides plus the two-sided limit."
                    },
                    {
                        title: "Left limit (x ‚Üí 1‚Åª)",
                        content: "Following from the left, the curve approaches y = 2.",
                        why: "<strong>Why use the left curve?</strong> The \\(1^-\\) superscript means 'values less than 1'. We use ONLY the piece of the graph where x < 1. Tracing from x = 0.5, 0.8, 0.99... the y-values approach 2."
                    },
                    {
                        title: "Right limit (x ‚Üí 1‚Å∫)",
                        content: "Following from the right, the curve approaches y = 4.",
                        why: "<strong>Why a different answer?</strong> The \\(1^+\\) superscript means 'values greater than 1'. We use ONLY the piece where x > 1. Tracing from x = 1.5, 1.2, 1.01... the y-values approach 4. Different pieces, different limits!"
                    },
                    {
                        title: "Two-sided limit?",
                        content: "Left (2) ‚â† Right (4), so \\(\\lim_{x \\to 1} f(x)\\) = DNE",
                        why: "<strong>Why DNE?</strong> The Method Selection Framework says: two-sided limit exists ONLY if left = right. Here 2 ‚â† 4. Common mistake: averaging (3) or picking one side. The correct answer is DNE (Does Not Exist)."
                    }
                ]
            },
            type3: {
                step: 0,
                playing: false,
                interval: null,
                speed: 1,
                steps: [
                    {
                        title: "Identify the pieces",
                        content: "At x = 2: Left uses x¬≤, Right uses 3x - 2, Middle piece is just f(2) = 5.",
                        why: "<strong>Why identify pieces first?</strong> Piecewise functions require matching each limit direction to its formula. For x ‚Üí 2‚Åª (approaching from left), use the 'x < 2' formula. For x ‚Üí 2‚Å∫ (from right), use the 'x > 2' formula. The 'x = 2' piece tells us f(2), NOT the limit!"
                    },
                    {
                        title: "Left limit (x ‚Üí 2‚Åª)",
                        content: "Use x¬≤: As x ‚Üí 2‚Åª, x¬≤ ‚Üí 4",
                        why: "<strong>Why x¬≤ and not f(2)=5?</strong> Since we're approaching from x < 2, we use the formula for that interval: x¬≤. Substituting x = 2 gives 2¬≤ = 4. Common mistake: using the x = 2 piece, which only gives f(2)."
                    },
                    {
                        title: "Right limit (x ‚Üí 2‚Å∫)",
                        content: "Use 3x - 2: As x ‚Üí 2‚Å∫, 3x - 2 ‚Üí 4",
                        why: "<strong>Why 3x - 2?</strong> We're approaching from x > 2, so we use that interval's formula. Substituting: 3(2) - 2 = 4. Note: it's a coincidence that both sides give 4. They could have been different!"
                    },
                    {
                        title: "Conclusion",
                        content: "Left = Right = 4. So \\(\\lim_{x \\to 2} f(x) = 4\\). Note: f(2) = 5, but the limit is 4!",
                        why: "<strong>Why is limit ‚â† f(2)?</strong> Limits care about WHERE the function HEADS, not the actual value. Both sides approach 4, so limit = 4. But f(2) = 5 (the middle piece). This is a removable discontinuity‚Äîthe limit exists but doesn't equal the function value!"
                    }
                ]
            },
            type5: {
                step: 0,
                playing: false,
                interval: null,
                speed: 1,
                steps: [
                    {
                        title: "Identify the vertical asymptote",
                        content: "Both \\(\\frac{1}{x^2}\\) and \\(\\frac{1}{x}\\) have vertical asymptotes at x = 0 because the denominator equals 0.",
                        why: "<strong>Why check for asymptotes?</strong> When the denominator approaches 0, the function value grows without bound. This is a signal that the limit might be ¬±‚àû or DNE. Always check: what happens to the denominator as x approaches the target?"
                    },
                    {
                        title: "Analyze 1/x¬≤ as x ‚Üí 0",
                        content: "From the left (x ‚Üí 0‚Åª): x¬≤ is positive, so 1/x¬≤ ‚Üí +‚àû. From the right (x ‚Üí 0‚Å∫): x¬≤ is also positive, so 1/x¬≤ ‚Üí +‚àû.",
                        why: "<strong>Why does sign matter?</strong> Since x¬≤ is ALWAYS positive (negative squared = positive), the fraction 1/x¬≤ is always positive. Both sides go to +‚àû, so we can write \\(\\lim_{x \\to 0} \\frac{1}{x^2} = +\\infty\\)."
                    },
                    {
                        title: "Analyze 1/x as x ‚Üí 0",
                        content: "From the left (x ‚Üí 0‚Åª): x is negative, so 1/x ‚Üí -‚àû. From the right (x ‚Üí 0‚Å∫): x is positive, so 1/x ‚Üí +‚àû.",
                        why: "<strong>Why do the sides disagree?</strong> Unlike x¬≤, plain x preserves the sign. Negative divided by tiny negative = large negative (‚Üí -‚àû). Positive divided by tiny positive = large positive (‚Üí +‚àû). The sides go in OPPOSITE directions!"
                    },
                    {
                        title: "Conclusion",
                        content: "\\(\\lim_{x \\to 0} \\frac{1}{x^2} = +\\infty\\) (both sides agree). \\(\\lim_{x \\to 0} \\frac{1}{x}\\) = <strong>DNE</strong> (sides disagree: -‚àû vs +‚àû).",
                        why: "<strong>Key distinction:</strong> A limit can equal +‚àû or -‚àû if BOTH sides agree (we say the limit 'is infinite'). But if one side is +‚àû and the other is -‚àû, the limit Does Not Exist. This is a critical difference on the AP exam!"
                    }
                ]
            }
        };

        function updateAnimDisplay(id) {
            const anim = animations[id];
            const total = anim.steps.length;
            document.getElementById(`${id}-counter`).textContent = `Step ${anim.step}/${total}`;
            document.getElementById(`${id}-progress`).style.width = `${(anim.step / total) * 100}%`;
            document.getElementById(`${id}-prev`).disabled = anim.step === 0;
            document.getElementById(`${id}-next`).disabled = anim.step === total;

            const display = document.getElementById(`${id}-steps`);
            if (anim.step === 0) {
                display.innerHTML = '<p style="color: var(--text-secondary); font-style: italic;">Click Play or Next to see the step-by-step solution.</p>';
            } else {
                const s = anim.steps[anim.step - 1];
                display.innerHTML = `
                    <span class="step-number">${anim.step}</span><strong>${s.title}</strong>
                    <div class="step-content">${s.content}</div>
                    <div class="step-reasoning">
                        <div class="step-reasoning-title">Why this step?</div>
                        ${s.why}
                    </div>
                `;
                if (typeof renderMathInElement !== 'undefined') {
                    renderMathInElement(display, { delimiters: [{left: '\\(', right: '\\)', display: false}] });
                }
            }
        }

        function animNext(id) {
            const anim = animations[id];
            if (anim.step < anim.steps.length) { anim.step++; updateAnimDisplay(id); }
            if (anim.step === anim.steps.length) animStop(id);
        }

        function animPrev(id) {
            const anim = animations[id];
            if (anim.step > 0) { anim.step--; updateAnimDisplay(id); }
        }

        function animToggle(id) {
            animations[id].playing ? animStop(id) : animStart(id);
        }

        function animStart(id) {
            const anim = animations[id];
            anim.playing = true;
            document.getElementById(`${id}-play`).innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
            anim.interval = setInterval(() => {
                if (anim.step < anim.steps.length) animNext(id);
                else animStop(id);
            }, 2000 / anim.speed);
        }

        function animStop(id) {
            const anim = animations[id];
            anim.playing = false;
            clearInterval(anim.interval);
            document.getElementById(`${id}-play`).innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>';
        }

        function animReset(id) {
            animStop(id);
            animations[id].step = 0;
            updateAnimDisplay(id);
        }

        function setAnimSpeed(id, speed) {
            animations[id].speed = speed;
            document.querySelectorAll(`#problem-type-${id.slice(-1)} .speed-btn`).forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            if (animations[id].playing) { animStop(id); animStart(id); }
        }

        // ========== PREDICTIONS ==========
        let correctCount = 0;
        const totalLevel1 = 4;

        function selectPred(el, id) {
            document.querySelectorAll(`#pred-${id} .prediction-option`).forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
        }

        function checkPred(id, correct) {
            const container = document.getElementById(`pred-${id}`);
            const selected = container.querySelector('.prediction-option.selected');
            const feedback = document.getElementById(`feedback-${id}`);

            if (!selected) { feedback.textContent = 'Select an answer!'; feedback.className = 'prediction-feedback incorrect'; return; }

            const isCorrect = selected.textContent.trim() === correct;
            container.querySelectorAll('.prediction-option').forEach(o => {
                if (o.textContent.trim() === correct) o.classList.add('correct');
                else if (o === selected && !isCorrect) o.classList.add('incorrect');
            });

            if (isCorrect) {
                feedback.textContent = '‚úì Correct!';
                feedback.className = 'prediction-feedback correct';
                if (!container.dataset.scored) {
                    container.dataset.scored = 'true';
                    correctCount++;
                    updateProgress();
                }
            } else {
                feedback.textContent = `‚úó The answer is ${correct}`;
                feedback.className = 'prediction-feedback incorrect';
            }

            container.querySelector('.prediction-submit').disabled = true;
        }

        function updateProgress() {
            document.getElementById('level-progress-fill').style.width = `${(correctCount / 6) * 100}%`;
            document.getElementById('level-progress-text').textContent = `${correctCount} / 6 correct`;
            localStorage.setItem('u1.1-correct', correctCount);

            if (correctCount >= totalLevel1) unlockLevel2();
        }

        function unlockLevel2() {
            document.getElementById('level2-badge').textContent = 'LEVEL 2: INTERMEDIATE';
            document.getElementById('level2-badge').classList.remove('locked');
            document.getElementById('level2-locked').style.display = 'none';
            document.getElementById('level2-content').style.display = 'block';
            setTimeout(initGraphs, 100);
        }

        function checkMulti5() {
            const answers = { '5a': '2', '5b': '-1', '5c': 'dne', '5d': '3' };
            let allCorrect = true;
            Object.entries(answers).forEach(([id, ans]) => {
                const input = document.getElementById(`ans-${id}`);
                const correct = input.value.trim().toLowerCase() === ans.toLowerCase();
                input.style.borderColor = correct ? 'var(--accent-success)' : 'var(--accent-danger)';
                if (!correct) allCorrect = false;
            });
            if (allCorrect && !document.getElementById('level2-content').dataset.scored) {
                document.getElementById('level2-content').dataset.scored = 'true';
                correctCount++;
                updateProgress();
                unlockLevel3();
            }
        }

        function unlockLevel3() {
            document.getElementById('level3-badge').textContent = 'LEVEL 3: AP EXAM STYLE';
            document.getElementById('level3-badge').classList.remove('locked');
            document.getElementById('level3-locked').style.display = 'none';
            document.getElementById('level3-content').style.display = 'block';
        }

        function checkQ6() {
            const selected = document.querySelector('input[name="q6"]:checked');
            if (!selected) { alert('Select an answer!'); return; }
            const labels = document.querySelectorAll('#level3-content label');
            labels.forEach(l => {
                const inp = l.querySelector('input');
                if (inp.value === 'C') { l.style.background = 'rgba(16,185,129,0.2)'; l.style.border = '2px solid var(--accent-success)'; }
                else if (inp === selected && inp.value !== 'C') { l.style.background = 'rgba(239,68,68,0.2)'; l.style.border = '2px solid var(--accent-danger)'; }
            });
            if (selected.value === 'C' && !document.getElementById('level3-content').dataset.q6scored) {
                document.getElementById('level3-content').dataset.q6scored = 'true';
                correctCount++;
                updateProgress();
            }
            document.getElementById('sol-6').classList.add('visible');
        }

        function toggleSol(id) { document.getElementById(id).classList.toggle('visible'); }

        // ========== PREREQUISITE PRACTICE ==========
        function checkPrereqAns(qId, el, isCorrect) {
            const container = document.getElementById(`prereq-${qId}`);
            container.querySelectorAll('.prereq-opt').forEach(o => o.classList.remove('selected', 'correct', 'wrong'));

            if (isCorrect) {
                el.classList.add('correct');
                document.getElementById(`prereq-${qId}-feedback`).style.display = 'block';
                document.getElementById(`prereq-${qId}-feedback`).innerHTML = '<span style="color: var(--accent-success);">‚úì Correct! You understand this concept.</span>';
            } else {
                el.classList.add('wrong');
                document.getElementById(`prereq-${qId}-feedback`).style.display = 'block';
                document.getElementById(`prereq-${qId}-feedback`).innerHTML = '<span style="color: var(--accent-danger);">‚úó Not quite. Try reviewing the concept above.</span>';
            }
        }

        function toggleExtendedLesson(id) {
            const lesson = document.getElementById(id);
            lesson.classList.toggle('visible');
            setTimeout(() => {
                if (typeof renderMathInElement !== 'undefined') {
                    renderMathInElement(lesson, { delimiters: [{left: '\\(', right: '\\)', display: false}] });
                }
            }, 100);
        }

        // ========== CONNECTIONS ==========
        function toggleConnectionPreview(id) { document.getElementById(id).style.display = document.getElementById(id).style.display === 'none' ? 'block' : 'none'; }

        // ========== ASSESSMENT ==========
        function toggleCheck(el) {
            el.querySelector('.assessment-checkbox').classList.toggle('checked');
            saveProgress();
        }

        function saveProgress() {
            const checked = [...document.querySelectorAll('.assessment-checkbox.checked')].length;
            localStorage.setItem('u1.1-assessment', checked);
        }

        // ========== GRAPHS ==========
        function initGraphs() {
            const dark = document.body.getAttribute('data-theme') === 'dark';
            const bg = dark ? '#1e293b' : '#ffffff';
            const grid = dark ? '#475569' : '#e2e8f0';
            const text = dark ? '#f1f5f9' : '#1e293b';
            const blue = '#3b82f6';
            const red = '#ef4444';

            const layout = {
                paper_bgcolor: bg, plot_bgcolor: bg,
                font: { color: text, family: 'Inter' },
                xaxis: { gridcolor: grid, zerolinecolor: grid },
                yaxis: { gridcolor: grid, zerolinecolor: grid },
                margin: { t: 30, b: 30, l: 30, r: 30 },
                showlegend: false
            };

            // Prereq 1
            const p1 = document.getElementById('prereq-graph-1');
            if (p1 && p1.offsetParent) {
                const x = [], y = [];
                for (let i = -2; i <= 5; i += 0.1) { x.push(i); y.push(i * i - 2); }
                Plotly.newPlot(p1, [{ x, y, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 } }], { ...layout, title: 'Track: As x ‚Üí 2, where does y go?' });
            }

            // Prereq 2
            const p2 = document.getElementById('prereq-graph-2');
            if (p2 && p2.offsetParent) {
                const xL = [], yL = [], xR = [], yR = [];
                for (let i = -2; i < 2; i += 0.05) { xL.push(i); yL.push(i + 2); }
                for (let i = 2.05; i <= 5; i += 0.05) { xR.push(i); yR.push(i + 2); }
                Plotly.newPlot(p2, [
                    { x: xL, y: yL, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 } },
                    { x: xR, y: yR, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 } },
                    { x: [2], y: [4], type: 'scatter', mode: 'markers', marker: { color: bg, size: 12, line: { color: blue, width: 2 } } },
                    { x: [2], y: [5], type: 'scatter', mode: 'markers', marker: { color: red, size: 12 } }
                ], { ...layout, title: 'Hole at (2,4), point at (2,5)' });
            }

            // Type 1 graph
            const t1 = document.getElementById('type1-graph');
            if (t1 && t1.offsetParent) {
                const x = [], y = [];
                for (let i = -1; i <= 5; i += 0.05) { if (Math.abs(i - 2) > 0.05) { x.push(i); y.push(0.5 * i + 2); } }
                Plotly.newPlot(t1, [
                    { x, y, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 } },
                    { x: [2], y: [3], type: 'scatter', mode: 'markers', marker: { color: bg, size: 12, line: { color: blue, width: 2 } } },
                    { x: [2], y: [5], type: 'scatter', mode: 'markers', marker: { color: red, size: 12 } }
                ], { ...layout, title: 'f(x) with hole at (2,3), point at (2,5)' });
            }

            // Type 2 graph (jump)
            const t2 = document.getElementById('type2-graph');
            if (t2 && t2.offsetParent) {
                const xL = [], yL = [], xR = [], yR = [];
                for (let i = -1; i < 1; i += 0.05) { xL.push(i); yL.push(i + 3); }
                for (let i = 1; i <= 4; i += 0.05) { xR.push(i); yR.push(2 * i + 2); }
                Plotly.newPlot(t2, [
                    { x: xL, y: yL, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 } },
                    { x: xR, y: yR, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 } },
                    { x: [1], y: [2], type: 'scatter', mode: 'markers', marker: { color: bg, size: 12, line: { color: blue, width: 2 } } },
                    { x: [1], y: [4], type: 'scatter', mode: 'markers', marker: { color: bg, size: 12, line: { color: blue, width: 2 } } }
                ], { ...layout, title: 'Jump discontinuity at x = 1' });
            }

            // Type 5 graph (limits involving infinity)
            const t5 = document.getElementById('type5-graph');
            if (t5 && t5.offsetParent) {
                // 1/x¬≤ (both sides ‚Üí +‚àû)
                const x1L = [], y1L = [], x1R = [], y1R = [];
                for (let i = -2; i < -0.1; i += 0.05) { x1L.push(i); y1L.push(1/(i*i)); }
                for (let i = 0.1; i <= 2; i += 0.05) { x1R.push(i); y1R.push(1/(i*i)); }
                // 1/x (left ‚Üí -‚àû, right ‚Üí +‚àû)
                const x2L = [], y2L = [], x2R = [], y2R = [];
                for (let i = -2; i < -0.1; i += 0.05) { x2L.push(i); y2L.push(1/i); }
                for (let i = 0.1; i <= 2; i += 0.05) { x2R.push(i); y2R.push(1/i); }
                Plotly.newPlot(t5, [
                    { x: x1L, y: y1L, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 }, name: '1/x¬≤' },
                    { x: x1R, y: y1R, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 }, showlegend: false },
                    { x: x2L, y: y2L, type: 'scatter', mode: 'lines', line: { color: red, width: 3 }, name: '1/x' },
                    { x: x2R, y: y2R, type: 'scatter', mode: 'lines', line: { color: red, width: 3 }, showlegend: false }
                ], { ...layout, title: 'Comparing 1/x¬≤ (blue) vs 1/x (red) near x = 0', showlegend: true, yaxis: { ...layout.yaxis, range: [-10, 10] } });
            }

            // Practice 1
            const pr1 = document.getElementById('practice-graph-1');
            if (pr1 && pr1.offsetParent) {
                const x = [], y = [];
                for (let i = -2; i <= 4; i += 0.05) { if (Math.abs(i - 1) > 0.05) { x.push(i); y.push(2 * i + 1); } }
                Plotly.newPlot(pr1, [
                    { x, y, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 } },
                    { x: [1], y: [3], type: 'scatter', mode: 'markers', marker: { color: bg, size: 12, line: { color: blue, width: 2 } } }
                ], { ...layout, title: 'Find limit as x ‚Üí 1' });
            }

            // Practice 3
            const pr3 = document.getElementById('practice-graph-3');
            if (pr3 && pr3.offsetParent) {
                const xL = [], yL = [], xR = [], yR = [];
                for (let i = -1; i < 2; i += 0.05) { xL.push(i); yL.push(-i + 3); }
                for (let i = 2; i <= 5; i += 0.05) { xR.push(i); yR.push(i + 2); }
                Plotly.newPlot(pr3, [
                    { x: xL, y: yL, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 } },
                    { x: xR, y: yR, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 } },
                    { x: [2], y: [1], type: 'scatter', mode: 'markers', marker: { color: bg, size: 12, line: { color: blue, width: 2 } } },
                    { x: [2], y: [4], type: 'scatter', mode: 'markers', marker: { color: bg, size: 12, line: { color: blue, width: 2 } } }
                ], { ...layout, title: 'Find one-sided limit as x ‚Üí 2‚Å∫' });
            }

            // Practice 5
            const pr5 = document.getElementById('practice-graph-5');
            if (pr5 && pr5.offsetParent) {
                const xL = [], yL = [], xR = [], yR = [];
                for (let i = -3; i < 0; i += 0.05) { xL.push(i); yL.push(2); }
                for (let i = 0; i <= 3; i += 0.05) { xR.push(i); yR.push(-1); }
                Plotly.newPlot(pr5, [
                    { x: xL, y: yL, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 } },
                    { x: xR, y: yR, type: 'scatter', mode: 'lines', line: { color: blue, width: 3 } },
                    { x: [0], y: [2], type: 'scatter', mode: 'markers', marker: { color: bg, size: 12, line: { color: blue, width: 2 } } },
                    { x: [0], y: [-1], type: 'scatter', mode: 'markers', marker: { color: bg, size: 12, line: { color: blue, width: 2 } } },
                    { x: [0], y: [3], type: 'scatter', mode: 'markers', marker: { color: red, size: 12 } }
                ], { ...layout, title: 'Multi-part: Find all limits and f(0)' });
            }
        }

        // ========== INIT ==========
        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('u1.1-correct');
            if (saved) { correctCount = parseInt(saved); updateProgress(); }

            Object.keys(animations).forEach(id => updateAnimDisplay(id));

            const checkKaTeX = setInterval(() => {
                if (typeof renderMathInElement !== 'undefined') {
                    renderMathInElement(document.body, { delimiters: [{ left: '\\(', right: '\\)', display: false }, { left: '\\[', right: '\\]', display: true }] });
                    clearInterval(checkKaTeX);
                }
            }, 100);

            setTimeout(initGraphs, 500);
        });

        window.addEventListener('resize', () => setTimeout(initGraphs, 100));

        // ========== PREDICTION MODE ==========
        let currentPrediction = { animId: null, stepNum: 0, correctIdx: 0 };

        const predictionQuestions = {
            type1: [
                { q: "What should we do first?", options: ["Identify the target x-value", "Calculate f(2)", "Check the y-intercept", "Find the derivative"], correct: 0 },
                { q: "How do we find the left-hand limit?", options: ["Look at f(2)", "Approach from x < 2", "Approach from x > 2", "Take the average"], correct: 1 },
                { q: "After finding left limit = 3, what's next?", options: ["We're done!", "Check the right side", "Calculate the derivative", "Find f(2)"], correct: 1 },
                { q: "Left = 3, Right = 3. What's the conclusion?", options: ["Limit DNE", "Limit = 3", "Need more info", "Limit = f(2)"], correct: 1 }
            ],
            type2: [
                { q: "What makes x = 1 special here?", options: ["It's an asymptote", "Function has a jump", "It's continuous", "f(1) = 0"], correct: 1 },
                { q: "For the LEFT limit, which direction?", options: ["x > 1", "x < 1", "Both sides", "From infinity"], correct: 1 },
                { q: "Left limit = 2. Now what for right limit?", options: ["It's also 2", "Check x > 1", "Limit is 2", "Can't determine"], correct: 1 },
                { q: "Left = 2, Right = 4. Two-sided limit?", options: ["Limit = 3 (average)", "Limit = 2", "Limit = 4", "DNE"], correct: 3 }
            ],
            type3: [
                { q: "Which formula for the LEFT limit at x = 2?", options: ["x¬≤", "3x - 2", "5", "Any formula"], correct: 0 },
                { q: "Evaluating x¬≤ as x ‚Üí 2‚Åª gives?", options: ["2", "4", "5", "6"], correct: 1 },
                { q: "Which formula for the RIGHT limit?", options: ["x¬≤", "3x - 2", "5", "Any formula"], correct: 1 },
                { q: "Left = 4, Right = 4, f(2) = 5. Limit?", options: ["5 (function value)", "4 (both sides match)", "DNE", "4.5 (average)"], correct: 1 }
            ],
            type5: [
                { q: "What causes a vertical asymptote at x = 0?", options: ["Numerator = 0", "Denominator = 0", "Function undefined", "Graph crosses axis"], correct: 1 },
                { q: "For 1/x¬≤, what happens to x¬≤ when x ‚Üí 0‚Åª?", options: ["x¬≤ is negative", "x¬≤ is positive", "x¬≤ is zero", "Depends on x"], correct: 1 },
                { q: "For 1/x, what's the sign when x ‚Üí 0‚Åª?", options: ["Positive (‚Üí +‚àû)", "Negative (‚Üí -‚àû)", "Zero", "Undefined"], correct: 1 },
                { q: "lim 1/x as x‚Üí0: left = -‚àû, right = +‚àû. Conclusion?", options: ["+‚àû", "-‚àû", "0", "DNE"], correct: 3 }
            ]
        };

        function showPredictionModal(animId, stepNum) {
            if (!predictionQuestions[animId] || stepNum > predictionQuestions[animId].length) {
                proceedToStep(animId);
                return;
            }

            const q = predictionQuestions[animId][stepNum - 1];
            currentPrediction = { animId, stepNum, correctIdx: q.correct };

            const modal = document.getElementById('prediction-modal');
            document.getElementById('pred-step-num').textContent = stepNum;
            document.getElementById('pred-question').textContent = q.q;

            const optionsDiv = document.getElementById('pred-options');
            optionsDiv.innerHTML = q.options.map((opt, i) => `
                <div class="prediction-modal-option" onclick="selectPredOption(this, ${i})">
                    <span class="prediction-modal-letter">${String.fromCharCode(65 + i)}</span>
                    <span>${opt}</span>
                </div>
            `).join('');

            document.getElementById('pred-submit').disabled = true;
            document.getElementById('pred-feedback').className = 'prediction-modal-feedback';
            document.getElementById('pred-feedback').style.display = 'none';

            document.getElementById('prediction-modal').classList.add('active');
        }

        function selectPredOption(el, idx) {
            document.querySelectorAll('#pred-options .prediction-modal-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            el.dataset.idx = idx;
            document.getElementById('pred-submit').disabled = false;
        }

        function submitPrediction() {
            const selected = document.querySelector('#pred-options .prediction-modal-option.selected');
            if (!selected) return;

            const idx = parseInt(selected.dataset.idx);
            const isCorrect = idx === currentPrediction.correctIdx;

            document.querySelectorAll('#pred-options .prediction-modal-option').forEach((o, i) => {
                if (i === currentPrediction.correctIdx) o.classList.add('correct');
                else if (o === selected && !isCorrect) o.classList.add('incorrect');
            });

            const feedback = document.getElementById('pred-feedback');
            feedback.style.display = 'block';
            if (isCorrect) {
                feedback.className = 'prediction-modal-feedback show correct';
                feedback.innerHTML = `
                    <div class="feedback-icon">‚úì</div>
                    <div class="feedback-title">Correct!</div>
                    <div class="feedback-explanation">Great thinking! Let's see how this step works.</div>
                    <button class="prediction-modal-continue" onclick="closePredictionAndProceed()">Continue ‚Üí</button>
                `;
            } else {
                const correctText = predictionQuestions[currentPrediction.animId][currentPrediction.stepNum - 1].options[currentPrediction.correctIdx];
                feedback.className = 'prediction-modal-feedback show incorrect';
                feedback.innerHTML = `
                    <div class="feedback-icon">‚úó</div>
                    <div class="feedback-title">Not quite</div>
                    <div class="feedback-explanation">The correct answer is: <strong>${correctText}</strong>. Watch closely to understand why!</div>
                    <button class="prediction-modal-continue" onclick="closePredictionAndProceed()">See Explanation ‚Üí</button>
                `;
            }

            document.getElementById('pred-submit').style.display = 'none';
        }

        function closePredictionAndProceed() {
            document.getElementById('prediction-modal').classList.remove('active');
            document.getElementById('pred-submit').style.display = 'block';
            proceedToStep(currentPrediction.animId);
        }

        function proceedToStep(animId) {
            const anim = animations[animId];
            anim.step++;
            updateAnimDisplay(animId);
        }

        // Override animNext to include prediction mode
        const originalAnimNext = animNext;
        function animNextWithPrediction(id) {
            const anim = animations[id];
            if (anim.step < anim.steps.length && anim.usePrediction) {
                showPredictionModal(id, anim.step + 1);
            } else {
                originalAnimNext(id);
            }
        }

        // Enable prediction mode for animations
        function enablePredictionMode(id) {
            animations[id].usePrediction = true;
        }

        // Initialize prediction mode for type1, type2, type3, type5
        ['type1', 'type2', 'type3', 'type5'].forEach(id => {
            if (animations[id]) animations[id].usePrediction = true;
        });
    </script>

    <!-- Prediction Modal -->
    <div class="prediction-modal-overlay" id="prediction-modal">
        <div class="prediction-modal">
            <div class="prediction-modal-header">
                <h3>ü§î Before we continue...</h3>
                <div class="prediction-modal-context">Step <span id="pred-step-num">1</span></div>
            </div>
            <div class="prediction-modal-body">
                <div class="prediction-modal-question" id="pred-question">What should we do next?</div>
                <div class="prediction-modal-options" id="pred-options">
                    <!-- Options injected by JS -->
                </div>
                <button class="prediction-modal-submit" id="pred-submit" onclick="submitPrediction()" disabled>Check My Prediction</button>
            </div>
            <div class="prediction-modal-feedback" id="pred-feedback">
                <!-- Feedback injected by JS -->
            </div>
        </div>
    </div>
</body>
</html>
