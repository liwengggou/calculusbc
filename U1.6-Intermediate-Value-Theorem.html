<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U1.6 Intermediate Value Theorem | AP Calculus BC</title>

    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Annotation System -->
    <link rel="stylesheet" href="lib/annotation.css">

    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #495057;
            --text-muted: #6c757d;
            --accent-primary: #4361ee;
            --accent-secondary: #3f37c9;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --border-color: #dee2e6;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --text-primary: #eef0f2;
            --text-secondary: #c9ccd1;
            --text-muted: #8b8f94;
            --border-color: #2d3748;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        .header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 40px 20px;
            margin-bottom: 30px;
            border-radius: var(--radius-lg);
        }

        .header-content { max-width: 1200px; margin: 0 auto; }

        .unit-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }

        .header-meta { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px; }

        .meta-item { display: flex; align-items: center; gap: 5px; font-size: 0.9rem; opacity: 0.9; }

        .freq-badge { background: rgba(255,255,255,0.25); padding: 2px 10px; border-radius: 12px; font-weight: 600; }

        .difficulty-header { background: rgba(239, 68, 68, 0.3); padding: 2px 10px; border-radius: 12px; font-weight: 600; }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            z-index: 1000;
            transition: all 0.3s;
        }

        .theme-toggle:hover { transform: scale(1.1); }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            background: var(--bg-secondary);
            padding: 10px;
            border-radius: var(--radius-lg);
            margin-bottom: 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-tab:hover { background: var(--bg-tertiary); }
        .nav-tab.active { background: var(--accent-primary); color: white; }

        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 30px;
            background: var(--accent-primary);
            border-radius: 2px;
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin-bottom: 20px;
        }

        .card-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 15px; }

        .key-point {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin-bottom: 10px;
            border-left: 4px solid var(--accent-primary);
        }

        .key-point-number {
            background: var(--accent-primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .prereq-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            margin-bottom: 15px;
            overflow: hidden;
        }

        .prereq-header {
            padding: 15px 20px;
            background: var(--bg-tertiary);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .prereq-header:hover { background: var(--border-color); }

        .prereq-title { font-weight: 600; display: flex; align-items: center; gap: 10px; }

        .prereq-badge { font-size: 0.75rem; padding: 2px 8px; border-radius: 10px; background: var(--accent-primary); color: white; }

        .prereq-content { padding: 20px; display: none; }
        .prereq-content.active { display: block; }

        .prereq-toggle { font-size: 1.2rem; transition: transform 0.3s; }
        .prereq-card.open .prereq-toggle { transform: rotate(180deg); }

        .theorem-box {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(63, 55, 201, 0.1));
            border: 2px solid var(--accent-primary);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin: 20px 0;
        }

        .theorem-title { font-weight: 700; font-size: 1.2rem; color: var(--accent-primary); margin-bottom: 15px; }

        .problem-type {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            margin-bottom: 15px;
            overflow: hidden;
        }

        .problem-type-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            flex-wrap: wrap;
            gap: 10px;
        }

        .problem-type-header:hover { background: var(--bg-tertiary); }

        .problem-type-title { font-weight: 600; font-size: 1.1rem; }

        .toggle-icon { font-size: 0.9rem; transition: transform 0.3s ease; margin-left: auto; padding-left: 15px; }
        .problem-type.collapsed .toggle-icon { transform: rotate(-90deg); }

        .problem-type-content {
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            max-height: 5000px;
            opacity: 1;
            padding: 0 20px 20px;
        }

        .problem-type.collapsed .problem-type-content { max-height: 0; opacity: 0; padding: 0 20px; }

        .difficulty-badge { font-size: 0.75rem; padding: 2px 10px; border-radius: 10px; font-weight: 500; }
        .difficulty-badge.easy { background: #d1fae5; color: #065f46; }
        .difficulty-badge.medium { background: #fef3c7; color: #92400e; }
        .difficulty-badge.hard { background: #fee2e2; color: #991b1b; }

        [data-theme="dark"] .difficulty-badge.easy { background: #065f46; color: #d1fae5; }
        [data-theme="dark"] .difficulty-badge.medium { background: #92400e; color: #fef3c7; }
        [data-theme="dark"] .difficulty-badge.hard { background: #991b1b; color: #fee2e2; }

        .pattern-box {
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
            border: 2px dashed var(--accent-primary);
            border-radius: var(--radius-md);
            padding: 20px;
            margin: 15px 0;
        }

        .pattern-label { font-size: 0.8rem; text-transform: uppercase; color: var(--accent-primary); font-weight: 600; margin-bottom: 8px; }

        .exam-tip {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid var(--accent-warning);
            padding: 15px 20px;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            margin: 15px 0;
        }

        [data-theme="dark"] .exam-tip { background: linear-gradient(135deg, #78350f, #92400e); }

        .exam-tip-label { font-weight: 600; color: var(--accent-warning); font-size: 0.85rem; margin-bottom: 5px; }

        .worked-example { background: var(--bg-tertiary); border-radius: var(--radius-lg); padding: 20px; margin: 20px 0; }

        .example-title { font-weight: 600; font-size: 1.1rem; margin-bottom: 15px; color: var(--accent-primary); }

        .example-problem {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: var(--radius-md);
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }

        .animation-container {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin: 15px 0;
        }

        .animation-step {
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: 10px;
            border-left: 4px solid var(--accent-primary);
            display: none;
        }

        .animation-step.active { display: block; animation: slideIn 0.3s ease; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .step-number { font-weight: 700; color: var(--accent-primary); margin-bottom: 5px; }

        .step-reasoning { font-size: 0.9rem; color: var(--text-muted); margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border-color); }

        .animation-controls { display: flex; align-items: center; gap: 10px; margin-top: 15px; flex-wrap: wrap; }

        .control-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .control-btn:hover { background: var(--accent-primary); color: white; border-color: var(--accent-primary); }

        .progress-bar { flex: 1; height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; min-width: 100px; }
        .progress-fill { height: 100%; background: var(--accent-primary); transition: width 0.3s ease; }

        .step-counter { font-size: 0.85rem; color: var(--text-muted); min-width: 80px; text-align: center; }

        .practice-problem {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin: 15px 0;
        }

        .practice-label { font-size: 0.8rem; text-transform: uppercase; color: var(--accent-success); font-weight: 600; margin-bottom: 10px; }
        .practice-question { font-size: 1.1rem; margin-bottom: 15px; }
        .practice-options { display: grid; gap: 10px; }

        .practice-option {
            padding: 12px 15px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .practice-option:hover { border-color: var(--accent-primary); }
        .practice-option.selected { border-color: var(--accent-primary); background: rgba(67, 97, 238, 0.1); }
        .practice-option.correct { border-color: var(--accent-success); background: rgba(16, 185, 129, 0.1); }
        .practice-option.incorrect { border-color: var(--accent-danger); background: rgba(239, 68, 68, 0.1); }

        .practice-feedback { margin-top: 15px; padding: 15px; border-radius: var(--radius-md); display: none; }
        .practice-feedback.show { display: block; }
        .practice-feedback.correct { background: rgba(16, 185, 129, 0.1); border: 1px solid var(--accent-success); }
        .practice-feedback.incorrect { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--accent-danger); }

        .decision-flowchart {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .flowchart-title { font-weight: 600; font-size: 1.1rem; margin-bottom: 20px; color: var(--accent-primary); text-align: center; }

        .flowchart-container { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .flowchart-node { padding: 12px 20px; border-radius: var(--radius-md); text-align: center; max-width: 300px; }
        .flowchart-node.question { background: var(--accent-primary); color: white; font-weight: 500; }
        .flowchart-node.answer { background: var(--bg-tertiary); border: 2px solid var(--border-color); }
        .flowchart-node.success { background: rgba(16, 185, 129, 0.1); border: 2px solid var(--accent-success); color: var(--accent-success); }
        .flowchart-node.warning { background: rgba(245, 158, 11, 0.1); border: 2px solid var(--accent-warning); color: var(--accent-warning); }
        .flowchart-node.danger { background: rgba(239, 68, 68, 0.1); border: 2px solid var(--accent-danger); color: var(--accent-danger); }

        .flowchart-arrow { font-size: 1.5rem; color: var(--text-muted); }

        .flowchart-branch { display: flex; gap: 40px; justify-content: center; flex-wrap: wrap; }
        .flowchart-branch-item { display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .flowchart-branch-label { padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600; }
        .flowchart-branch-label.yes { background: var(--accent-success); color: white; }
        .flowchart-branch-label.no { background: var(--accent-danger); color: white; }

        .mistake-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 15px;
        }

        .mistake-wrong { background: rgba(239, 68, 68, 0.1); padding: 12px 15px; border-radius: var(--radius-md); margin-bottom: 10px; text-decoration: line-through; color: var(--accent-danger); }
        .mistake-correct { background: rgba(16, 185, 129, 0.1); padding: 12px 15px; border-radius: var(--radius-md); margin-bottom: 10px; border-left: 4px solid var(--accent-success); }
        .mistake-reason { font-size: 0.9rem; color: var(--text-muted); padding-top: 10px; }

        .connection-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .connection-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .connection-content h4 { font-size: 1rem; margin-bottom: 5px; }
        .connection-content p { font-size: 0.9rem; color: var(--text-muted); }

        .graph-container {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 15px;
            margin: 15px 0;
        }

        .checklist { background: var(--bg-secondary); border-radius: var(--radius-lg); padding: 20px; }
        .checklist-item { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--border-color); }
        .checklist-item:last-child { border-bottom: none; }
        .checklist-checkbox { width: 20px; height: 20px; cursor: pointer; }

        /* IVT Visual */
        .ivt-conditions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .ivt-condition {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 15px;
            text-align: center;
        }

        .ivt-condition.check { border: 2px solid var(--accent-success); }
        .ivt-condition h4 { margin-bottom: 5px; }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .nav-tabs { justify-content: center; }
            .nav-tab { padding: 8px 12px; font-size: 0.85rem; }
            .flowchart-branch { flex-direction: column; gap: 20px; }
        }

        /* ========== TRANSLATION POPUP ========== */
        .translate-popup {
            position: absolute;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            padding: 8px;
            z-index: 10000;
            animation: translateFadeIn 0.2s ease;
            max-width: 350px;
        }

        @keyframes translateFadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-5px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        .translate-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .translate-btn:hover { background: #2563eb; transform: scale(1.02); }
        .translate-btn:disabled { background: var(--text-muted); cursor: not-allowed; transform: none; }

        .translation-result {
            margin-top: 8px;
            padding: 10px 12px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-primary);
            word-wrap: break-word;
        }

        .translation-error {
            color: var(--accent-danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .translate-popup::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--bg-primary);
        }

        .translate-popup.below::after {
            top: -8px;
            bottom: auto;
            border-top-color: transparent;
            border-bottom-color: var(--bg-primary);
        }

        /* ========== INLINE PRACTICE ========== */
        .inline-practice {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 20px;
        }

        .inline-practice-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-success);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .inline-practice-title::before {
            content: '‚úèÔ∏è';
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">üåô</button>

    <header class="header">
        <div class="header-content">
            <span class="unit-badge">Unit 1: Limits and Continuity</span>
            <h1>U1.6 Intermediate Value Theorem (IVT)</h1>
            <p>Use continuity to guarantee the existence of solutions</p>
            <div class="header-meta">
                <span class="meta-item">üìö CB Topic: 1.16</span>
                <span class="meta-item"><span class="freq-badge">üìö Standard</span></span>
                <span class="meta-item"><span class="difficulty-header">High Difficulty</span></span>
                <span class="meta-item">‚è±Ô∏è ~35 min</span>
                <span class="meta-item">üìä MCQ: 14 questions</span>
            </div>
        </div>
    </header>

    <div class="container">
        <nav class="nav-tabs">
            <button class="nav-tab active" data-section="keypoints">Key Points</button>
            <button class="nav-tab" data-section="prerequisites">Prerequisites</button>
            <button class="nav-tab" data-section="concepts">Concepts</button>
            <button class="nav-tab" data-section="problemtypes">Problem Types</button>
            <button class="nav-tab" data-section="examtips">Exam Tips</button>
            <button class="nav-tab" data-section="mistakes">Common Mistakes</button>
            <button class="nav-tab" data-section="connections">Connections</button>
        </nav>

        <!-- Key Points Section -->
        <section id="keypoints" class="section active">
            <h2 class="section-title">Key Points</h2>

            <div class="key-point">
                <span class="key-point-number">1</span>
                <div>
                    <strong>IVT guarantees existence, not uniqueness.</strong> It tells you there IS at least one solution, but doesn't tell you how many or where exactly.
                </div>
            </div>

            <div class="key-point">
                <span class="key-point-number">2</span>
                <div>
                    <strong>IVT requires THREE conditions:</strong><br>
                    (1) \(f\) is continuous on \([a, b]\)<br>
                    (2) \(k\) is between \(f(a)\) and \(f(b)\)<br>
                    (3) Then there exists \(c\) in \((a, b)\) such that \(f(c) = k\)
                </div>
            </div>

            <div class="key-point">
                <span class="key-point-number">3</span>
                <div>
                    <strong>Sign change = root exists.</strong> If \(f(a)\) and \(f(b)\) have opposite signs (and \(f\) is continuous), then \(f(c) = 0\) for some \(c\) between \(a\) and \(b\).
                </div>
            </div>

            <div class="key-point">
                <span class="key-point-number">4</span>
                <div>
                    <strong>Continuity is essential.</strong> IVT does NOT apply if the function is discontinuous on the interval. Always state this condition!
                </div>
            </div>

            <div class="key-point">
                <span class="key-point-number">5</span>
                <div>
                    <strong>Closed interval matters.</strong> IVT requires a closed interval \([a, b]\), not an open interval.
                </div>
            </div>
        </section>

        <!-- Prerequisites Section -->
        <section id="prerequisites" class="section">
            <h2 class="section-title">Prerequisites</h2>

            <div class="prereq-card">
                <div class="prereq-header" onclick="togglePrereq(this)">
                    <span class="prereq-title">
                        <span class="prereq-badge">Internal</span>
                        U1.4 Continuity
                    </span>
                    <span class="prereq-toggle">‚ñº</span>
                </div>
                <div class="prereq-content">
                    <p><strong>Why it matters:</strong> IVT only applies to continuous functions! You must be able to verify continuity.</p>
                    <ul style="margin: 10px 0 10px 20px;">
                        <li>Three conditions for continuity at a point</li>
                        <li>Continuity on closed vs open intervals</li>
                        <li>Which functions are continuous on their domains</li>
                    </ul>
                    <p><a href="U1.4-Continuity-and-Discontinuities.html" style="color: var(--accent-primary);">‚Üí Review U1.4 Continuity</a></p>
                </div>
            </div>
        </section>

        <!-- Concepts Section -->
        <section id="concepts" class="section">
            <h2 class="section-title">Core Concepts</h2>

            <div class="theorem-box">
                <div class="theorem-title">üìê The Intermediate Value Theorem (IVT)</div>
                <p>If \(f\) is <strong>continuous on \([a, b]\)</strong>, and \(k\) is any number between \(f(a)\) and \(f(b)\), then there exists at least one number \(c\) in \((a, b)\) such that \(f(c) = k\).</p>
            </div>

            <div class="ivt-conditions">
                <div class="ivt-condition check">
                    <h4>Condition 1</h4>
                    <p>\(f\) continuous on \([a, b]\)</p>
                </div>
                <div class="ivt-condition check">
                    <h4>Condition 2</h4>
                    <p>\(k\) between \(f(a)\) and \(f(b)\)</p>
                </div>
                <div class="ivt-condition">
                    <h4>Conclusion</h4>
                    <p>\(\exists c \in (a,b): f(c) = k\)</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Visual Intuition</h3>
                <p>A continuous function "draws without lifting the pencil." If you start at height \(f(a)\) and end at height \(f(b)\), you must pass through every height in between.</p>

                <div class="graph-container" id="ivt-graph"></div>
            </div>

            <div class="decision-flowchart">
                <div class="flowchart-title">Decision Flowchart: When Can You Apply IVT?</div>
                <div class="flowchart-container">
                    <div class="flowchart-node question">Is f continuous on [a, b]?</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-branch">
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label yes">YES</div>
                            <div class="flowchart-node answer">Continue ‚Üì</div>
                        </div>
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label no">NO</div>
                            <div class="flowchart-node danger">Cannot use IVT!</div>
                        </div>
                    </div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node question">Is k between f(a) and f(b)?</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-branch">
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label yes">YES</div>
                            <div class="flowchart-node success">IVT applies! ‚àÉc: f(c) = k</div>
                        </div>
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label no">NO</div>
                            <div class="flowchart-node danger">Cannot conclude anything</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Special Case: Finding Roots</h3>
                <p>When looking for a root (where \(f(c) = 0\)), IVT says:</p>
                <div class="pattern-box">
                    <div class="pattern-label">Root Existence</div>
                    <p>If \(f\) is continuous on \([a, b]\) and \(f(a)\) and \(f(b)\) have <strong>opposite signs</strong>, then there exists \(c \in (a, b)\) where \(f(c) = 0\).</p>
                </div>

                <div class="exam-tip">
                    <div class="exam-tip-label">üí° EXAM TIP</div>
                    To show a root exists: (1) State f is continuous, (2) Calculate f(a) and f(b), (3) Show they have opposite signs, (4) Conclude by IVT.
                </div>
            </div>
        </section>

        <!-- Problem Types Section -->
        <section id="problemtypes" class="section">
            <h2 class="section-title">Problem Types</h2>

            <!-- Type 1: Show a Solution Exists -->
            <div class="problem-type collapsed" id="problem-type-1">
                <div class="problem-type-header">
                    <span class="problem-type-title">Type 1: Show a Root/Solution Exists</span>
                    <span class="difficulty-badge medium">Intermediate</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="problem-type-content">
                    <div class="pattern-box">
                        <div class="pattern-label">Recognition Pattern</div>
                        <p>"Show that \(f(x) = 0\) has a solution in \([a, b]\)" or "Prove a root exists"</p>
                    </div>

                    <div class="worked-example">
                        <div class="example-title">Worked Example</div>
                        <div class="example-problem">
                            Show that \(f(x) = x^3 + x - 1\) has a root in the interval \([0, 1]\).
                        </div>

                        <div class="animation-container" id="anim-root">
                            <div class="animation-step" data-step="1">
                                <div class="step-number">Step 1: Verify continuity</div>
                                <p>\(f(x) = x^3 + x - 1\) is a polynomial.</p>
                                <p>Polynomials are continuous everywhere, so \(f\) is continuous on \([0, 1]\).</p>
                                <div class="step-reasoning">üí≠ ALWAYS start by stating continuity. This is required for IVT.</div>
                            </div>
                            <div class="animation-step" data-step="2">
                                <div class="step-number">Step 2: Calculate f(a) and f(b)</div>
                                <p>\(f(0) = 0^3 + 0 - 1 = -1\)</p>
                                <p>\(f(1) = 1^3 + 1 - 1 = 1\)</p>
                                <div class="step-reasoning">üí≠ Evaluate the function at both endpoints.</div>
                            </div>
                            <div class="animation-step" data-step="3">
                                <div class="step-number">Step 3: Check if 0 is between f(0) and f(1)</div>
                                <p>\(f(0) = -1 < 0\) and \(f(1) = 1 > 0\)</p>
                                <p>Since \(-1 < 0 < 1\), the value 0 is between \(f(0)\) and \(f(1)\).</p>
                                <div class="step-reasoning">üí≠ The function values have opposite signs, so 0 is between them.</div>
                            </div>
                            <div class="animation-step" data-step="4">
                                <div class="step-number">Step 4: Apply IVT</div>
                                <p>By the Intermediate Value Theorem, since \(f\) is continuous on \([0, 1]\) and \(0\) is between \(f(0)\) and \(f(1)\), there exists at least one \(c \in (0, 1)\) such that \(f(c) = 0\).</p>
                                <div class="step-reasoning">üí≠ State the conclusion clearly, referencing IVT by name.</div>
                            </div>
                            <div class="animation-controls">
                                <button class="control-btn" onclick="animPrev('anim-root')">‚Üê Prev</button>
                                <button class="control-btn" onclick="animNext('anim-root')">Next ‚Üí</button>
                                <div class="progress-bar"><div class="progress-fill" style="width: 25%"></div></div>
                                <span class="step-counter">Step 1 of 4</span>
                                <button class="control-btn" onclick="animReset('anim-root')">Reset</button>
                            </div>
                        </div>
                    </div>

                    <div class="practice-problem">
                        <div class="practice-label">Practice Problem</div>
                        <div class="practice-question">Does \(g(x) = \cos x - x\) have a root in \([0, \pi/2]\)?</div>
                        <div class="practice-options">
                            <div class="practice-option" data-correct="true">Yes, because g(0) = 1 > 0 and g(œÄ/2) = -œÄ/2 < 0</div>
                            <div class="practice-option">No, because cosine is not continuous</div>
                            <div class="practice-option">Cannot determine without graphing</div>
                            <div class="practice-option">No, because the interval is too small</div>
                        </div>
                        <div class="practice-feedback"></div>
                    </div>
                </div>
            </div>

            <!-- Type 2: Show f(c) = k -->
            <div class="problem-type collapsed" id="problem-type-2">
                <div class="problem-type-header">
                    <span class="problem-type-title">Type 2: Show f(c) = k for Some Value k</span>
                    <span class="difficulty-badge medium">Intermediate</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="problem-type-content">
                    <div class="pattern-box">
                        <div class="pattern-label">Recognition Pattern</div>
                        <p>"Show there exists \(c\) where \(f(c) = 5\)" (or some specific non-zero value)</p>
                    </div>

                    <div class="worked-example">
                        <div class="example-title">Worked Example</div>
                        <div class="example-problem">
                            If \(f\) is continuous on \([1, 5]\) with \(f(1) = 3\) and \(f(5) = 8\), must there exist \(c\) where \(f(c) = 6\)?
                        </div>

                        <div class="animation-container" id="anim-fck">
                            <div class="animation-step" data-step="1">
                                <div class="step-number">Step 1: Check continuity</div>
                                <p>Given: \(f\) is continuous on \([1, 5]\) ‚úì</p>
                                <div class="step-reasoning">üí≠ This is given in the problem.</div>
                            </div>
                            <div class="animation-step" data-step="2">
                                <div class="step-number">Step 2: Check if k is between f(a) and f(b)</div>
                                <p>\(f(1) = 3\) and \(f(5) = 8\)</p>
                                <p>Is 6 between 3 and 8? Yes! \(3 < 6 < 8\) ‚úì</p>
                                <div class="step-reasoning">üí≠ The target value 6 lies in the range [f(1), f(5)].</div>
                            </div>
                            <div class="animation-step" data-step="3">
                                <div class="step-number">Step 3: Conclude</div>
                                <p>By IVT, since \(f\) is continuous on \([1, 5]\) and \(6\) is between \(f(1) = 3\) and \(f(5) = 8\), there exists \(c \in (1, 5)\) such that \(f(c) = 6\).</p>
                                <p style="margin-top: 10px;"><strong>Answer: Yes!</strong></p>
                                <div class="step-reasoning">üí≠ Both conditions are met, so IVT guarantees the existence.</div>
                            </div>
                            <div class="animation-controls">
                                <button class="control-btn" onclick="animPrev('anim-fck')">‚Üê Prev</button>
                                <button class="control-btn" onclick="animNext('anim-fck')">Next ‚Üí</button>
                                <div class="progress-bar"><div class="progress-fill" style="width: 33%"></div></div>
                                <span class="step-counter">Step 1 of 3</span>
                                <button class="control-btn" onclick="animReset('anim-fck')">Reset</button>
                            </div>
                        </div>
                    </div>

                    <div class="inline-practice">
                        <h4 class="inline-practice-title">Practice This Type</h4>
                        <div class="practice-problem">
                            <div class="practice-label">Practice Problem</div>
                            <div class="practice-question">If \(g\) is continuous on \([0, 5]\) with \(g(0) = 3\) and \(g(5) = 7\), which value of \(k\) is guaranteed to have a solution \(g(c) = k\) for some \(c \in (0, 5)\)?</div>
                            <div class="practice-options">
                                <div class="practice-option">2</div>
                                <div class="practice-option" data-correct="true">5</div>
                                <div class="practice-option">8</div>
                                <div class="practice-option">10</div>
                            </div>
                            <div class="practice-feedback"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Type 3: Table-Based IVT -->
            <div class="problem-type collapsed" id="problem-type-3">
                <div class="problem-type-header">
                    <span class="problem-type-title">Type 3: Table-Based IVT</span>
                    <span class="difficulty-badge medium">Intermediate</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="problem-type-content">
                    <div class="pattern-box">
                        <div class="pattern-label">Recognition Pattern</div>
                        <p>Given a table of values, find an interval where a root must exist</p>
                    </div>

                    <div class="worked-example">
                        <div class="example-title">Worked Example</div>
                        <div class="example-problem">
                            <p>Let \(f\) be continuous. Given the table below, in which interval must \(f(x) = 0\) have a solution?</p>
                            <table style="margin: 15px auto; border-collapse: collapse;">
                                <tr style="background: var(--accent-primary); color: white;">
                                    <th style="padding: 10px; border: 1px solid var(--border-color);">x</th>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">1</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">2</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">3</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">4</td>
                                </tr>
                                <tr>
                                    <th style="padding: 10px; border: 1px solid var(--border-color);">f(x)</th>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">-2</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">-1</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">3</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">5</td>
                                </tr>
                            </table>
                        </div>

                        <div class="animation-container" id="anim-table">
                            <div class="animation-step" data-step="1">
                                <div class="step-number">Step 1: Look for sign changes</div>
                                <p>Check consecutive pairs of f(x) values:</p>
                                <ul style="margin: 10px 0 0 20px;">
                                    <li>f(1) = -2, f(2) = -1: both negative (no sign change)</li>
                                    <li>f(2) = -1, f(3) = 3: negative to positive (SIGN CHANGE!)</li>
                                    <li>f(3) = 3, f(4) = 5: both positive (no sign change)</li>
                                </ul>
                                <div class="step-reasoning">üí≠ A sign change means 0 is between those values.</div>
                            </div>
                            <div class="animation-step" data-step="2">
                                <div class="step-number">Step 2: Apply IVT</div>
                                <p>Since \(f\) is continuous on \([2, 3]\) and \(f(2) = -1 < 0 < 3 = f(3)\), by IVT there exists \(c \in (2, 3)\) where \(f(c) = 0\).</p>
                                <p style="margin-top: 15px;"><strong>Answer: The interval \((2, 3)\)</strong></p>
                                <div class="step-reasoning">üí≠ The sign change between x=2 and x=3 guarantees a root.</div>
                            </div>
                            <div class="animation-controls">
                                <button class="control-btn" onclick="animPrev('anim-table')">‚Üê Prev</button>
                                <button class="control-btn" onclick="animNext('anim-table')">Next ‚Üí</button>
                                <div class="progress-bar"><div class="progress-fill" style="width: 50%"></div></div>
                                <span class="step-counter">Step 1 of 2</span>
                                <button class="control-btn" onclick="animReset('anim-table')">Reset</button>
                            </div>
                        </div>
                    </div>

                    <div class="inline-practice">
                        <h4 class="inline-practice-title">Practice This Type</h4>
                        <div class="practice-problem">
                            <div class="practice-label">Practice Problem</div>
                            <div class="practice-question">Given the table for a continuous function \(h\):
                                <table style="margin: 10px auto; border-collapse: collapse; font-size: 0.9rem;">
                                    <tr><th style="padding: 8px; border: 1px solid var(--border-color);">x</th>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">0</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">2</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">4</td></tr>
                                    <tr><th style="padding: 8px; border: 1px solid var(--border-color);">h(x)</th>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">5</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">-3</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">2</td></tr>
                                </table>
                                In which interval must \(h(x) = 0\) have a solution?</div>
                            <div class="practice-options">
                                <div class="practice-option" data-correct="true">(0, 2)</div>
                                <div class="practice-option">(2, 4)</div>
                                <div class="practice-option">Both (0,2) and (2,4)</div>
                                <div class="practice-option">Cannot determine</div>
                            </div>
                            <div class="practice-feedback"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Type 4: Why IVT Cannot Apply -->
            <div class="problem-type collapsed" id="problem-type-4">
                <div class="problem-type-header">
                    <span class="problem-type-title">Type 4: When IVT Does NOT Apply</span>
                    <span class="difficulty-badge hard">Advanced</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="problem-type-content">
                    <div class="pattern-box">
                        <div class="pattern-label">Recognition Pattern</div>
                        <p>"Does IVT guarantee...?" where the answer is NO</p>
                    </div>

                    <div class="exam-tip">
                        <div class="exam-tip-label">üí° EXAM TIP</div>
                        IVT fails when: (1) f is not continuous, or (2) k is not between f(a) and f(b). Always check both conditions!
                    </div>

                    <div class="card">
                        <h4>Example: Discontinuous Function</h4>
                        <p>\(f(x) = \begin{cases} x & x < 2 \\ x + 3 & x \geq 2 \end{cases}\)</p>
                        <p style="margin-top: 10px;">Even though \(f(1) = 1\) and \(f(3) = 6\), we CANNOT conclude \(f(c) = 4\) exists in \((1, 3)\) because \(f\) has a jump discontinuity at \(x = 2\).</p>
                    </div>

                    <div class="practice-problem">
                        <div class="practice-label">Practice Problem</div>
                        <div class="practice-question">Given \(f\) is continuous on \([0, 4]\) with \(f(0) = 2\) and \(f(4) = 8\), does IVT guarantee \(f(c) = 10\) for some \(c\)?</div>
                        <div class="practice-options">
                            <div class="practice-option">Yes, because f is continuous</div>
                            <div class="practice-option" data-correct="true">No, because 10 is not between 2 and 8</div>
                            <div class="practice-option">Yes, because polynomials reach all values</div>
                            <div class="practice-option">Cannot determine</div>
                        </div>
                        <div class="practice-feedback"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Exam Tips Section -->
        <section id="examtips" class="section">
            <h2 class="section-title">Exam Tips</h2>

            <div class="decision-flowchart">
                <div class="flowchart-title">IVT Verification Checklist</div>
                <div class="flowchart-container">
                    <div class="flowchart-node question">‚òê State f is continuous on [a, b]</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node question">‚òê Calculate f(a) and f(b)</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node question">‚òê Show k is between f(a) and f(b)</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node question">‚òê Conclude by IVT: ‚àÉc ‚àà (a,b) with f(c) = k</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node success">Complete IVT argument ‚úì</div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Writing Tips for Free Response</h3>

                <div class="exam-tip">
                    <div class="exam-tip-label">üí° TIP #1: Name the Theorem</div>
                    Always write "By the Intermediate Value Theorem" or "By IVT" in your answer. Graders look for this!
                </div>

                <div class="exam-tip">
                    <div class="exam-tip-label">üí° TIP #2: State Continuity FIRST</div>
                    Begin with "Since f is continuous on [a, b]..." This is often worth a point on FRQs.
                </div>

                <div class="exam-tip">
                    <div class="exam-tip-label">üí° TIP #3: Show the Inequality</div>
                    Write "f(a) = ___ < k < ___ = f(b)" (or with > if values are reversed). Make the "between" relationship explicit.
                </div>

                <div class="exam-tip">
                    <div class="exam-tip-label">üí° TIP #4: "At Least One"</div>
                    IVT guarantees "at least one" c exists. Never claim you know exactly how many or where.
                </div>
            </div>
        </section>

        <!-- Common Mistakes Section -->
        <section id="mistakes" class="section">
            <h2 class="section-title">Common Mistakes</h2>

            <div class="decision-flowchart">
                <div class="flowchart-title">Error Prevention Checklist</div>
                <div class="flowchart-container">
                    <div class="flowchart-node question">Did you verify continuity?</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-branch">
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label yes">YES</div>
                            <div class="flowchart-node answer">Continue</div>
                        </div>
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label no">NO</div>
                            <div class="flowchart-node danger">Must state continuity!</div>
                        </div>
                    </div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-node question">Is k strictly between f(a) and f(b)?</div>
                    <div class="flowchart-arrow">‚Üì</div>
                    <div class="flowchart-branch">
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label yes">YES</div>
                            <div class="flowchart-node success">IVT applies ‚úì</div>
                        </div>
                        <div class="flowchart-branch-item">
                            <div class="flowchart-branch-label no">NO</div>
                            <div class="flowchart-node danger">Cannot use IVT</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mistake-item">
                <h4>Mistake #1: Forgetting to state continuity</h4>
                <div class="mistake-wrong">"f(1) = -3 and f(2) = 5, so f(c) = 0 for some c" ‚úó</div>
                <div class="mistake-correct">
                    <strong>Correct:</strong> "Since f is continuous on [1, 2] and f(1) = -3 < 0 < 5 = f(2), by IVT there exists c ‚àà (1, 2) such that f(c) = 0."
                </div>
                <div class="mistake-reason">
                    <strong>Why this happens:</strong> Students assume continuity is obvious. On the AP exam, you MUST state it explicitly.
                </div>
            </div>

            <div class="mistake-item">
                <h4>Mistake #2: Claiming IVT when k is not between f(a) and f(b)</h4>
                <div class="mistake-wrong">"f(0) = 2, f(3) = 5, so f(c) = 10 exists" ‚úó</div>
                <div class="mistake-correct">
                    <strong>Correct:</strong> 10 is NOT between 2 and 5, so IVT cannot guarantee f(c) = 10.
                </div>
            </div>

            <div class="mistake-item">
                <h4>Mistake #3: Thinking IVT tells us WHERE c is</h4>
                <div class="mistake-wrong">"By IVT, the root is at x = 1.5" ‚úó</div>
                <div class="mistake-correct">
                    <strong>Correct:</strong> IVT only guarantees existence, not the exact location. Say "there exists c ‚àà (a, b)" but don't specify where.
                </div>
            </div>

            <div class="mistake-item">
                <h4>Mistake #4: Thinking IVT tells us HOW MANY solutions exist</h4>
                <div class="mistake-wrong">"By IVT, there is exactly one root" ‚úó</div>
                <div class="mistake-correct">
                    <strong>Correct:</strong> IVT guarantees "at least one" solution. There could be more!
                </div>
            </div>
        </section>

        <!-- Connections Section -->
        <section id="connections" class="section">
            <h2 class="section-title">Forward Connections</h2>

            <div class="connection-card">
                <div class="connection-icon">üìà</div>
                <div class="connection-content">
                    <h4>U5.1 Mean Value Theorem (MVT)</h4>
                    <p>MVT is another existence theorem that requires continuity. IVT practice prepares you for MVT's structure.</p>
                </div>
            </div>

            <div class="connection-card">
                <div class="connection-icon">üìä</div>
                <div class="connection-content">
                    <h4>U5.2 Extreme Value Theorem (EVT)</h4>
                    <p>EVT also requires continuity on a closed interval. These three theorems (IVT, MVT, EVT) form a family.</p>
                </div>
            </div>

            <div class="connection-card">
                <div class="connection-icon">üî¢</div>
                <div class="connection-content">
                    <h4>Numerical Methods (Bisection)</h4>
                    <p>IVT is the basis for the bisection method of finding roots‚Äîrepeatedly halving intervals where sign changes occur.</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Self-Assessment Checklist</h3>
                <div class="checklist">
                    <div class="checklist-item">
                        <input type="checkbox" class="checklist-checkbox" id="check1">
                        <label for="check1">I can state the Intermediate Value Theorem</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" class="checklist-checkbox" id="check2">
                        <label for="check2">I always verify continuity before applying IVT</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" class="checklist-checkbox" id="check3">
                        <label for="check3">I can show roots exist using sign changes</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" class="checklist-checkbox" id="check4">
                        <label for="check4">I can use tables to find intervals with roots</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" class="checklist-checkbox" id="check5">
                        <label for="check5">I know when IVT cannot be applied</label>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Theme Toggle
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            document.querySelector('.theme-toggle').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            renderGraphs();
        }

        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);
        document.querySelector('.theme-toggle').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

        // Navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.getAttribute('data-section')).classList.add('active');
            });
        });

        // Prerequisites Toggle
        function togglePrereq(header) {
            const card = header.parentElement;
            card.classList.toggle('open');
            card.querySelector('.prereq-content').classList.toggle('active');
        }

        // Problem Type Accordion
        document.querySelectorAll('.problem-type .problem-type-header').forEach(header => {
            header.addEventListener('click', () => {
                const parent = header.parentElement;
                const wasCollapsed = parent.classList.contains('collapsed');
                document.querySelectorAll('.problem-type[id^="problem-type-"]').forEach(pt => pt.classList.add('collapsed'));
                if (wasCollapsed) parent.classList.remove('collapsed');
            });
        });

        // Animation System
        const animations = {};

        function initAnimation(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const steps = container.querySelectorAll('.animation-step');
            animations[containerId] = { currentStep: 1, totalSteps: steps.length };
            updateAnimation(containerId);
        }

        function updateAnimation(containerId) {
            const container = document.getElementById(containerId);
            const anim = animations[containerId];
            container.querySelectorAll('.animation-step').forEach((step, i) => {
                step.classList.toggle('active', i + 1 === anim.currentStep);
            });
            container.querySelector('.progress-fill').style.width = `${(anim.currentStep / anim.totalSteps) * 100}%`;
            container.querySelector('.step-counter').textContent = `Step ${anim.currentStep} of ${anim.totalSteps}`;
        }

        function animNext(id) { if (animations[id].currentStep < animations[id].totalSteps) { animations[id].currentStep++; updateAnimation(id); } }
        function animPrev(id) { if (animations[id].currentStep > 1) { animations[id].currentStep--; updateAnimation(id); } }
        function animReset(id) { animations[id].currentStep = 1; updateAnimation(id); }

        // Practice Problems
        document.querySelectorAll('.practice-option').forEach(option => {
            option.addEventListener('click', function() {
                const problem = this.closest('.practice-problem');
                problem.querySelectorAll('.practice-option').forEach(opt => opt.classList.remove('selected', 'correct', 'incorrect'));
                this.classList.add('selected');
                const feedback = problem.querySelector('.practice-feedback');
                if (this.getAttribute('data-correct') === 'true') {
                    this.classList.add('correct');
                    feedback.textContent = '‚úì Correct!';
                    feedback.className = 'practice-feedback show correct';
                } else {
                    this.classList.add('incorrect');
                    problem.querySelector('[data-correct="true"]').classList.add('correct');
                    feedback.textContent = '‚úó Not quite. See the correct answer.';
                    feedback.className = 'practice-feedback show incorrect';
                }
            });
        });

        // Render IVT Graph
        function renderGraphs() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            const bgColor = isDark ? '#1a1a2e' : '#ffffff';
            const textColor = isDark ? '#eef0f2' : '#212529';
            const gridColor = isDark ? '#2d3748' : '#e9ecef';

            const ivtDiv = document.getElementById('ivt-graph');
            if (ivtDiv) {
                const x = [], y = [];
                for (let i = 0; i <= 4; i += 0.05) {
                    x.push(i);
                    y.push(i*i - 2*i + 1);
                }

                Plotly.newPlot('ivt-graph', [
                    { x: x, y: y, type: 'scatter', mode: 'lines', line: { color: '#4361ee', width: 3 }, name: 'f(x) = x¬≤ - 2x + 1' },
                    { x: [0, 4], y: [1, 9], type: 'scatter', mode: 'markers', marker: { color: '#ef4444', size: 12 }, name: 'Endpoints' },
                    { x: [0, 4], y: [4, 4], type: 'scatter', mode: 'lines', line: { color: '#10b981', width: 2, dash: 'dash' }, name: 'k = 4' },
                    { x: [3], y: [4], type: 'scatter', mode: 'markers', marker: { color: '#10b981', size: 12, symbol: 'star' }, name: 'c where f(c) = k' }
                ], {
                    title: { text: 'IVT: f(a) = 1, f(b) = 9, so f(c) = 4 must exist', font: { color: textColor } },
                    xaxis: { gridcolor: gridColor, zerolinecolor: textColor, tickfont: { color: textColor }, title: { text: 'x', font: { color: textColor } } },
                    yaxis: { gridcolor: gridColor, zerolinecolor: textColor, tickfont: { color: textColor }, title: { text: 'f(x)', font: { color: textColor } } },
                    paper_bgcolor: bgColor, plot_bgcolor: bgColor, font: { color: textColor },
                    annotations: [
                        { x: 0, y: 1, text: 'f(a) = 1', showarrow: true, arrowhead: 2, ax: -50, ay: 30, font: { color: textColor } },
                        { x: 4, y: 9, text: 'f(b) = 9', showarrow: true, arrowhead: 2, ax: 50, ay: -30, font: { color: textColor } },
                        { x: 3, y: 4, text: 'f(c) = 4', showarrow: true, arrowhead: 2, ax: 50, ay: 20, font: { color: textColor } }
                    ]
                }, { responsive: true });
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '\\[', right: '\\]', display: true},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError: false
            });

            initAnimation('anim-root');
            initAnimation('anim-fck');
            initAnimation('anim-table');
            renderGraphs();
        });

        // Practice Problem Handler
        document.querySelectorAll('.practice-option').forEach(option => {
            option.addEventListener('click', function() {
                const problem = this.closest('.practice-problem');
                const options = problem.querySelectorAll('.practice-option');
                const feedback = problem.querySelector('.practice-feedback');

                options.forEach(opt => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                });

                this.classList.add('selected');

                const isCorrect = this.getAttribute('data-correct') === 'true';

                if (isCorrect) {
                    this.classList.add('correct');
                    feedback.textContent = '‚úì Correct! Great work.';
                    feedback.className = 'practice-feedback show correct';
                } else {
                    this.classList.add('incorrect');
                    const correctOption = problem.querySelector('[data-correct="true"]');
                    correctOption.classList.add('correct');
                    feedback.textContent = '‚úó Not quite. The correct answer is highlighted.';
                    feedback.className = 'practice-feedback show incorrect';
                }
            });
        });

        // ============================================
        // TRANSLATION FEATURE
        // ============================================
        const TRANSLATION_CONFIG = {
            endpoint: 'https://test-3gop834c099077bf-1302819770.ap-shanghai.app.tcloudbase.com/api/translate',
            maxLength: 2000
        };

        async function translateToChinese(text) {
            if (text.length > TRANSLATION_CONFIG.maxLength) {
                text = text.substring(0, TRANSLATION_CONFIG.maxLength);
            }

            const response = await fetch(TRANSLATION_CONFIG.endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text, source: 'auto', target: 'zh' })
            });

            if (!response.ok) {
                throw new Error(`Translation failed: ${response.status}`);
            }

            const data = await response.json();
            return data.translation;
        }

        let translatePopup = null;

        function clearTranslatePopup() {
            if (translatePopup) {
                translatePopup.remove();
                translatePopup = null;
            }
        }

        function createTranslatePopup(selectedText, rect) {
            clearTranslatePopup();

            const popup = document.createElement('div');
            popup.className = 'translate-popup';
            popup.id = 'translate-popup';

            const scrollTop = window.scrollY;
            const scrollLeft = window.scrollX;
            const spaceAbove = rect.top;
            const showBelow = spaceAbove < 70;

            let top = showBelow
                ? rect.bottom + scrollTop + 12
                : rect.top + scrollTop - 60;
            let left = rect.left + scrollLeft + (rect.width / 2);

            const viewportWidth = window.innerWidth;
            left = Math.max(100, Math.min(left, viewportWidth - 100));

            if (showBelow) popup.classList.add('below');

            popup.style.cssText = `
                position: absolute;
                top: ${top}px;
                left: ${left}px;
                transform: translateX(-50%);
            `;

            popup.innerHTML = `
                <button class="translate-btn" id="do-translate">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 8l6 6M4 14h6v6M15 4h5v5M14.5 4l5 5"/>
                        <path d="M2 5h12M9 2v6"/>
                    </svg>
                    ÁøªËØëÊàê‰∏≠Êñá
                </button>
            `;

            document.body.appendChild(popup);
            translatePopup = popup;

            popup.querySelector('#do-translate').addEventListener('click', async () => {
                const btn = popup.querySelector('#do-translate');
                btn.disabled = true;
                btn.textContent = 'ÁøªËØë‰∏≠...';

                try {
                    const translation = await translateToChinese(selectedText);
                    btn.style.display = 'none';

                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'translation-result';
                    resultDiv.textContent = translation;
                    popup.appendChild(resultDiv);

                    if (!showBelow) {
                        const newHeight = popup.offsetHeight;
                        popup.style.top = `${rect.top + scrollTop - newHeight - 12}px`;
                    }
                } catch (error) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'translation-result translation-error';
                    errorDiv.textContent = 'ÁøªËØëÂ§±Ë¥•ÔºåËØ∑ÈáçËØï';
                    popup.appendChild(errorDiv);
                    btn.style.display = 'none';
                }
            });
        }

        function handleTextSelection() {
            setTimeout(() => {
                const selection = window.getSelection();
                const selectedText = selection.toString().trim();

                if (selectedText.length > 0 && selectedText.length < 5000) {
                    const range = selection.getRangeAt(0);
                    const rect = range.getBoundingClientRect();
                    createTranslatePopup(selectedText, rect);
                }
            }, 10);
        }

        (function initTranslation() {
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            if (isTouchDevice) return;

            document.addEventListener('mouseup', (e) => {
                if (e.target.closest('#translate-popup')) return;
                handleTextSelection();
            });

            document.addEventListener('mousedown', (e) => {
                if (!e.target.closest('#translate-popup')) {
                    clearTranslatePopup();
                }
            });

            document.addEventListener('selectstart', clearTranslatePopup);
            document.addEventListener('scroll', clearTranslatePopup);
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    clearTranslatePopup();
                    window.getSelection().removeAllRanges();
                }
            });
        })();
    </script>

    <!-- Tencent CloudBase JS SDK -->
    <script src="https://static.cloudbase.net/cloudbase-js-sdk/latest/cloudbase.full.js"></script>

    <!-- Custom Annotation System -->
    <script src="lib/annotation.js"></script>
</body>
</html>
